<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Optuna optimization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="optuna-optimization_files/libs/clipboard/clipboard.min.js"></script>
<script src="optuna-optimization_files/libs/quarto-html/quarto.js"></script>
<script src="optuna-optimization_files/libs/quarto-html/popper.min.js"></script>
<script src="optuna-optimization_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="optuna-optimization_files/libs/quarto-html/anchor.min.js"></script>
<link href="optuna-optimization_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="optuna-optimization_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="optuna-optimization_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="optuna-optimization_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="optuna-optimization_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.32.0.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>


  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Optuna optimization</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>We consider a scheduling problem where the schedule is represented by a vector <span class="math inline">\(\mathbf{x} = (x_0, x_1, \ldots, x_{T-1})^T\)</span>. This vector comprises <span class="math inline">\(T\)</span> components, where <span class="math inline">\(x_j\)</span> denotes the non-negative allocation (e.g., number of patients or tasks) to time slot <span class="math inline">\(j\)</span>, for <span class="math inline">\(j = 0, \ldots, T-1\)</span>. A fundamental constraint is that the total allocation across all time slots must equal a fixed constant <span class="math inline">\(N\)</span>: <span class="math display">\[ \sum_{j=0}^{T-1} x_j = N \]</span> We require <span class="math inline">\(x_j \ge 0\)</span> for all <span class="math inline">\(j = 0, \ldots, T-1\)</span>. Consequently, a valid schedule <span class="math inline">\(\mathbf{x}\)</span> belongs to the feasible set <span class="math inline">\(\mathcal{F} = \{ \mathbf{z} \in \mathbb{D}^{T} \mid \sum_{j=0}^{T-1} z_j = N, z_j \ge 0 \text{ for all } j\}\)</span>, where <span class="math inline">\(\mathbb{D}\)</span> is typically the set of non-negative integers (<span class="math inline">\(\mathbb{Z}_{\ge 0}\)</span>) or non-negative real numbers (<span class="math inline">\(\mathbb{R}_{\ge 0}\)</span>). The definitions below use <span class="math inline">\(\mathbb{R}_{\ge 0}^{T}\)</span>.</p>
<p>We define a neighborhood structure for local search based on perturbation vectors derived from a set of <span class="math inline">\(T\)</span> basis change vectors, <span class="math inline">\(v_i \in \mathbb{R}^{T}\)</span>, for <span class="math inline">\(i = 0, \ldots, T-1\)</span>. These basis vectors represent elementary shifts of allocation between time slots:</p>
<ul>
<li><p><span class="math inline">\(v_0 = (-1, 0, \ldots, 0, 1)^T\)</span> (Shift unit <em>from</em> slot 0 <em>to</em> slot <span class="math inline">\(T-1\)</span>)</p></li>
<li><p><span class="math inline">\(v_1 = (1, -1, 0, \ldots, 0)^T\)</span> (Shift unit <em>from</em> slot 1 <em>to</em> slot 0)</p></li>
<li><p><span class="math inline">\(v_i = (0, \ldots, 0, \underbrace{1}_{\text{pos } i-1}, \underbrace{-1}_{\text{pos } i}, 0, \ldots, 0)^T\)</span> for <span class="math inline">\(i = 2, \ldots, T-1\)</span> (Shift unit <em>from</em> slot <span class="math inline">\(i\)</span> <em>to</em> slot <span class="math inline">\(i-1\)</span>)</p></li>
</ul>
<p>A key property of these basis vectors is that the sum of components for each vector is zero: <span class="math inline">\(\sum_{j=0}^{T-1} v_{ij} = 0\)</span> for all <span class="math inline">\(i=0, \ldots, T-1\)</span>.</p>
<p>Perturbations are constructed using a binary selection vector <span class="math inline">\(\mathbf{U} = (u_0, u_1, \ldots, u_{T-1})^T\)</span>, where <span class="math inline">\(u_i \in \{0, 1\}\)</span>. Each <span class="math inline">\(u_i\)</span> indicates whether the basis change <span class="math inline">\(v_i\)</span> is included in the perturbation. The resulting perturbation vector <span class="math inline">\(\mathbf{r}(\mathbf{U}) \in \mathbb{R}^{T}\)</span> is the linear combination: <span class="math display">\[ \mathbf{r}(\mathbf{U}) := \sum_{i=0}^{T-1} u_i v_i \]</span></p>
<p>Since each <span class="math inline">\(v_i\)</span> sums to zero, any perturbation <span class="math inline">\(\mathbf{r}(\mathbf{U})\)</span> also sums to zero: <span class="math inline">\(\sum_{j=0}^{T-1} r_j(\mathbf{U}) = 0\)</span>. This ensures that applying such a perturbation to a valid schedule <span class="math inline">\(\mathbf{x}\)</span> preserves the total allocation <span class="math inline">\(N\)</span>.</p>
<p>Two specific selection vectors result in a zero perturbation:</p>
<ol type="1">
<li><p>If <span class="math inline">\(\mathbf{U} = \mathbf{0} = (0, \ldots, 0)^T\)</span>, then <span class="math inline">\(\mathbf{r}(\mathbf{0}) = \mathbf{0}\)</span>.</p></li>
<li><p>If <span class="math inline">\(\mathbf{U} = \mathbf{1} = (1, \ldots, 1)^T\)</span>, then <span class="math inline">\(\mathbf{r}(\mathbf{1}) = \sum_{i=0}^{T-1} v_i = \mathbf{0}\)</span>, as demonstrated by summing the components of the basis vectors.</p></li>
</ol>
<p>The neighborhood of a schedule <span class="math inline">\(\mathbf{x} \in \mathcal{F}\)</span>, denoted by <span class="math inline">\(\mathcal{N}(\mathbf{x})\)</span>, comprises all distinct, feasible schedules <span class="math inline">\(\mathbf{x}'\)</span> reachable by applying a non-zero perturbation <span class="math inline">\(\mathbf{r}(\mathbf{U})\)</span>: <span class="math display">\[ \mathcal{N}(\mathbf{x}) := \{ \mathbf{x}' \mid \mathbf{x}' = \mathbf{x} + \mathbf{r}(\mathbf{U}), \mathbf{U} \in \{0,1\}^T, \mathbf{r}(\mathbf{U}) \neq \mathbf{0}, \text{ and } x'_j \ge 0 \text{ for all } j = 0, \ldots, T-1 \} \]</span></p>
<p>Note that because <span class="math inline">\(\sum r_j(\mathbf{U}) = 0\)</span>, any <span class="math inline">\(\mathbf{x}'\)</span> generated from <span class="math inline">\(\mathbf{x} \in \mathcal{F}\)</span> automatically satisfies <span class="math inline">\(\sum x'_j = N\)</span>. The condition <span class="math inline">\(\mathbf{r}(\mathbf{U}) \neq \mathbf{0}\)</span> explicitly excludes the transformations resulting from <span class="math inline">\(\mathbf{U}=\mathbf{0}\)</span> and <span class="math inline">\(\mathbf{U}=\mathbf{1}\)</span>.</p>
<p>There are <span class="math inline">\(2^T\)</span> possible selection vectors <span class="math inline">\(\mathbf{U}\)</span>. Since <span class="math inline">\(\mathbf{U}=\mathbf{0}\)</span> and <span class="math inline">\(\mathbf{U}=\mathbf{1}\)</span> both yield <span class="math inline">\(\mathbf{r}(\mathbf{U}) = \mathbf{0}\)</span> (assuming <span class="math inline">\(T \ge 1\)</span> so <span class="math inline">\(\mathbf{0} \neq \mathbf{1}\)</span>), there are <span class="math inline">\(2^T - 2\)</span> distinct selection vectors that generate non-zero perturbations. This establishes an upper bound on the number of candidate neighbors generated by unique non-zero perturbations: <span class="math display">\[ |\mathcal{N}(\mathbf{x})| \le 2^T - 2 \]</span></p>
<p>The actual size of the neighborhood may be smaller than this bound due to the non-negativity constraint (<span class="math inline">\(\mathbf{x}'_j \ge 0\)</span>) rendering some potential neighbors infeasible.</p>
<p>The local search aims to iteratively improve the schedule based on an objective function <span class="math inline">\(C(\mathbf{x})\)</span>. Given the following constants:</p>
<ul>
<li><p><span class="math inline">\(\mathbf{x}\)</span>: The current feasible schedule vector (<span class="math inline">\(\mathbf{x} \in \mathcal{F}\)</span>).</p></li>
<li><p><span class="math inline">\(N\)</span>: The total number of patients/tasks to be scheduled.</p></li>
<li><p><span class="math inline">\(T\)</span>: The number of time slots.</p></li>
<li><p><span class="math inline">\(d\)</span>: The duration of each time slot.</p></li>
<li><p><span class="math inline">\(s\)</span>: The service time distribution.</p></li>
<li><p><span class="math inline">\(q\)</span>: The no-show probability.</p></li>
<li><p><span class="math inline">\(w\)</span>: The objective function weight (<span class="math inline">\(w \in [0, 1]\)</span>).</p></li>
<li><p><span class="math inline">\(EWT(\mathbf{x})\)</span>: Expected Waiting Time for schedule <span class="math inline">\(\mathbf{x}\)</span>.</p></li>
<li><p><span class="math inline">\(ESP(\mathbf{x})\)</span>: Expected Staff Penalty (e.g., idle/overtime) for schedule <span class="math inline">\(\mathbf{x}\)</span>.</p></li>
</ul>
<p>and the objective function: <span class="math display">\[ C(\mathbf{x}) = w \cdot EWT(\mathbf{x}) + (1-w) \cdot ESP(\mathbf{x}) \]</span></p>
<p>, a neighborhood search step seeks to find a neighbor <span class="math inline">\(\mathbf{x}' \in \mathcal{N}(\mathbf{x})\)</span> such that <span class="math inline">\(C(\mathbf{x}') &lt; C(\mathbf{x})\)</span>. This involves evaluating candidate schedules generated by <span class="math inline">\(\mathbf{x} + \mathbf{r}(\mathbf{U})\)</span> for the <span class="math inline">\(2^T - 2\)</span> selection vectors <span class="math inline">\(\mathbf{U}\)</span> (where <span class="math inline">\(\mathbf{U} \neq \mathbf{0}\)</span> and <span class="math inline">\(\mathbf{U} \neq \mathbf{1}\)</span>), checking their feasibility (non-negativity), and comparing their objective function values to <span class="math inline">\(C(\mathbf{x})\)</span>.</p>
<p>In case such an improvement is found, the algorithm updates the current schedule to <span class="math inline">\(\mathbf{x}'\)</span> and continues the search. If no better neighbor is found, the algorithm terminates, returning the best schedule found during the search. Because of the multi-modular nature of the objective function, a local optimum must also be the global optimum.</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>Load all necessary packages and initialize the constants</p>
<div id="3d948984" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> optuna</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging <span class="co"># Optional: To see pruned trial messages if desired</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> combinations</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> List, Dict, Tuple, Callable, Optional, Union, Any, Iterable <span class="co"># Added type hints</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> multiprocessing <span class="im">as</span> mp</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Configure logging to see messages about pruned trials</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># optuna.logging.get_logger("optuna").addHandler(logging.StreamHandler(sys.stdout))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="318d4b1d" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions <span class="im">import</span> compute_convolutions, bailey_welch_schedule, get_v_star</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">12</span> <span class="co"># Number of patients</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">8</span> <span class="co"># Number of intervals</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="dv">5</span> <span class="co"># Length of each interval</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>max_s <span class="op">=</span> <span class="dv">20</span> <span class="co"># Maximum service time</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.20</span> <span class="co"># Probability of a scheduled patient not showing up</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># Weight for the waiting time in objective function</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>v_star <span class="op">=</span> get_v_star(T)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"v_star: </span><span class="ch">\n</span><span class="st">"</span>, v_star)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create service time distribution</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_weighted_list(max_s: <span class="bu">int</span>, l: <span class="bu">float</span>, i: <span class="bu">int</span>) <span class="op">-&gt;</span> Optional[np.ndarray]:</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Generates a service time probability distribution using optimization.</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">    This function creates a discrete probability distribution over max_s possible</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">    service times (from 1 to max_s). It uses optimization (SLSQP) to find a</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">    distribution whose weighted average service time is as close as possible</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">    to a target value 'l', subject to the constraint that the probabilities</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">    sum to 1 and each probability is between 0 and 1.</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">    After finding the distribution, it sorts the probabilities: the first 'i'</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">    probabilities (corresponding to service times 1 to i) are sorted in</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">    ascending order, and the remaining probabilities (service times i+1 to max_s)</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">    are sorted in descending order.</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Note:</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">        - Requires NumPy and SciPy libraries (specifically scipy.optimize.minimize).</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">        max_s (int): Maximum service time parameter (number of probability bins).</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">                     Must be a positive integer.</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">        l (float): The target weighted average service time for the distribution.</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">                   Must be between 1 and max_s, inclusive.</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">        i (int): The index determining the sorting split point. Probabilities</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">                 for service times 1 to 'i' are sorted ascendingly, and</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">                 probabilities for service times 'i+1' to 'max_s' are sorted</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co">                 descendingly. Must be between 1 and max_s-1 for meaningful sorting.</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">        numpy.ndarray: An array of size max_s+1. The first element (index 0) is 0.</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">                       Elements from index 1 to max_s represent the calculated</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co">                       and sorted probability distribution, summing to 1.</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">                       Returns None if optimization fails or inputs are invalid.</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Input Validation ---</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(max_s, <span class="bu">int</span>) <span class="kw">or</span> max_s <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: max_s must be a positive integer, but got </span><span class="sc">{</span>max_s<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(l, (<span class="bu">int</span>, <span class="bu">float</span>)) <span class="kw">or</span> <span class="kw">not</span> (<span class="dv">1</span> <span class="op">&lt;=</span> l <span class="op">&lt;=</span> max_s):</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: Target average 'l' (</span><span class="sc">{</span>l<span class="sc">}</span><span class="ss">) must be between 1 and max_s (</span><span class="sc">{</span>max_s<span class="sc">}</span><span class="ss">)."</span>)</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(i, <span class="bu">int</span>) <span class="kw">or</span> <span class="kw">not</span> (<span class="dv">0</span> <span class="op">&lt;</span> i <span class="op">&lt;</span> max_s):</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: Sorting index 'i' (</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">) must be between 1 and max_s-1 (</span><span class="sc">{</span>max_s<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">)."</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If clamping is desired instead of error:</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(f"Warning: Index 'i' ({i}) is outside the valid range (1 to {max_s-1}). Clamping i.")</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># i = max(1, min(i, max_s - 1))</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span> <span class="co"># Strict check based on docstring requirement</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Inner helper function for optimization ---</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> objective(x: np.ndarray) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Objective function: Squared difference between weighted average and target l."""</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># x represents probabilities P(1) to P(max_s)</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>        service_times <span class="op">=</span> np.arange(<span class="dv">1</span>, max_s <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        weighted_avg <span class="op">=</span> np.dot(service_times, x) <span class="co"># Equivalent to sum(k * P(k) for k=1 to max_s)</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (weighted_avg <span class="op">-</span> l) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Constraints for optimization ---</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Constraint 1: The sum of the probabilities must be 1</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    constraints <span class="op">=</span> ({</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'type'</span>: <span class="st">'eq'</span>,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'fun'</span>: <span class="kw">lambda</span> x: np.<span class="bu">sum</span>(x) <span class="op">-</span> <span class="fl">1.0</span> <span class="co"># Ensure float comparison</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bounds: Each probability value x[k] must be between 0 and 1</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Creates a list of max_s tuples, e.g., [(0, 1), (0, 1), ..., (0, 1)]</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> [(<span class="dv">0</span>, <span class="dv">1</span>)] <span class="op">*</span> max_s</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initial guess: Use Dirichlet distribution to get a random distribution that sums to 1.</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Provides a starting point for the optimizer. np.ones(max_s) gives equal weights initially.</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    initial_guess <span class="op">=</span> np.random.dirichlet(np.ones(max_s))</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Perform Optimization ---</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> minimize(</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>            objective,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>            initial_guess,</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>            method<span class="op">=</span><span class="st">'SLSQP'</span>,</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>            bounds<span class="op">=</span>bounds,</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>            constraints<span class="op">=</span>constraints,</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>            <span class="co"># options={'disp': False} # Set True for detailed optimizer output</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if optimization was successful</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> result.success:</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Warning: Optimization failed! Message: </span><span class="sc">{</span>result<span class="sc">.</span>message<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Optionally print result object for more details: print(result)</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span> <span class="co"># Indicate failure</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The optimized probabilities (P(1) to P(max_s))</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>        optimized_probs <span class="op">=</span> result.x</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Post-process: Correct potential floating point inaccuracies ---</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure probabilities are non-negative and sum *exactly* to 1</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>        optimized_probs[optimized_probs <span class="op">&lt;</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span> <span class="co"># Clamp small negatives to 0</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>        current_sum <span class="op">=</span> np.<span class="bu">sum</span>(optimized_probs)</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> np.isclose(current_sum, <span class="fl">1.0</span>):</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> current_sum <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># Avoid division by zero</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>                 optimized_probs <span class="op">/=</span> current_sum <span class="co"># Normalize to sum to 1</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>                 <span class="bu">print</span>(<span class="st">"Warning: Optimization resulted in zero sum probabilities after clamping negatives."</span>)</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># Handle this case - maybe return uniform distribution or None</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">return</span> <span class="va">None</span> <span class="co"># Or return uniform: np.ones(max_s) / max_s</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"An error occurred during optimization: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Reorder the probabilities based on the index 'i' ---</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split the probabilities P(1)...P(i) and P(i+1)...P(max_s)</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note: Python slicing is exclusive of the end index, array indexing is 0-based.</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>    <span class="co"># result.x[0] corresponds to P(1), result.x[i-1] to P(i).</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># result.x[i] corresponds to P(i+1), result.x[max_s-1] to P(max_s).</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    first_part_probs <span class="op">=</span> optimized_probs[:i]   <span class="co"># Probabilities P(1) to P(i)</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    second_part_probs <span class="op">=</span> optimized_probs[i:]  <span class="co"># Probabilities P(i+1) to P(max_s)</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort the first part ascending, the second part descending</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    sorted_first_part <span class="op">=</span> np.sort(first_part_probs)</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    sorted_second_part <span class="op">=</span> np.sort(second_part_probs)[::<span class="op">-</span><span class="dv">1</span>] <span class="co"># [::-1] reverses</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Create final output array ---</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Array of size max_s + 1, initialized to zeros. Index 0 unused.</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> np.zeros(max_s <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign the sorted probabilities back into the correct slots (index 1 onwards)</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>    values[<span class="dv">1</span> : i <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> sorted_first_part      <span class="co"># Assign P(1)...P(i)</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    values[i <span class="op">+</span> <span class="dv">1</span> : max_s <span class="op">+</span> <span class="dv">1</span>] <span class="op">=</span> sorted_second_part <span class="co"># Assign P(i+1)...P(max_s)</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Final check on sum after potential normalization/sorting</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> np.isclose(np.<span class="bu">sum</span>(values[<span class="dv">1</span>:]), <span class="fl">1.0</span>):</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="ss">f"Warning: Final distribution sum is </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(values[<span class="dv">1</span>:])<span class="sc">}</span><span class="ss">, not 1.0. Check logic."</span>)</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the final array with the sorted probability distribution</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> values</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">5</span>  <span class="co"># First 5 highest values in ascending order, rest in descending order</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> generate_weighted_list(max_s, l, i)</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Service time distribution: "</span>, s)</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sum: "</span>, np.<span class="bu">sum</span>(s))  <span class="co"># This should be 1</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Weighted service time:"</span>, np.dot(np.arange(<span class="bu">len</span>(s)), s))  <span class="co"># This should be close to l</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>x_star <span class="op">=</span> bailey_welch_schedule(T, d, N, s)</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Initial schedule: </span><span class="sc">{</span>x_star<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>convolutions <span class="op">=</span> compute_convolutions(s, N, q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>v_star: 
 [[-1  0  0  0  0  0  0  1]
 [ 1 -1  0  0  0  0  0  0]
 [ 0  1 -1  0  0  0  0  0]
 [ 0  0  1 -1  0  0  0  0]
 [ 0  0  0  1 -1  0  0  0]
 [ 0  0  0  0  1 -1  0  0]
 [ 0  0  0  0  0  1 -1  0]
 [ 0  0  0  0  0  0  1 -1]]
Service time distribution:  [0.         0.00707335 0.00770885 0.01808447 0.07668253 0.12127228
 0.17574881 0.16486745 0.06991769 0.06969619 0.06700453 0.04645802
 0.04258072 0.03713712 0.02619675 0.02008162 0.01758428 0.01287967
 0.00942974 0.00644513 0.0031508 ]
Sum:  1.0000000000000469
Weighted service time: 8.083333310213016
Initial schedule: [2, 1, 0, 1, 1, 0, 1, 6]</code></pre>
</div>
</div>
<p>The simplest application of applying Bayes Optimization to the Bailey-Welch schedule is to use the initial schedule as the starting point and try to find the next optimal schedule. The following code implements this approach. It uses the <code>optuna</code> library to perform the optimization.</p>
<div id="02da4dca" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions <span class="im">import</span> calculate_objective_serv_time_lookup</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Configuration ---</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>x_star <span class="op">=</span> np.array(x_star)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive T (list length) and N (target sum) from x_star</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>LIST_LENGTH <span class="op">=</span> <span class="bu">len</span>(x_star)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>TARGET_SUM <span class="op">=</span> <span class="bu">sum</span>(x_star)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Sanity check x_star (optional but recommended) ---</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">any</span>(x <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">for</span> x <span class="kw">in</span> x_star):</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Starting schedule x_star contains negative values: </span><span class="sc">{</span>x_star<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> LIST_LENGTH <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>     <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Starting schedule x_star cannot be empty."</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Other fixed parameters for the evaluation function</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>DURATION_THRESHOLD <span class="op">=</span> d <span class="co"># Example: Time slot duration</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>WEIGHT <span class="op">=</span> w <span class="co"># Example: Weight for ewt in the final objective (0 &lt;= w &lt;= 1)</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Define function to create the objective</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_objective(</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    T: <span class="bu">int</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    N: <span class="bu">int</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    d: <span class="bu">int</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    convolutions: Dict[<span class="bu">int</span>, np.ndarray],</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    w: <span class="bu">float</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Callable[[optuna.trial.Trial], <span class="bu">float</span>]:</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates the objective function for Optuna, capturing T, N, d, convolutions, and w.</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">    (Code is identical to the previous version)</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="dv">0</span> <span class="op">&lt;=</span> w <span class="op">&lt;=</span> <span class="dv">1</span>:</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>         <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Weight w must be between 0 and 1, but got </span><span class="sc">{</span>w<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">1</span> <span class="kw">not</span> <span class="kw">in</span> convolutions <span class="kw">and</span> N <span class="op">&gt;</span> <span class="dv">0</span>: <span class="co"># Check key 1 only if N &gt; 0</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>         <span class="co"># If N=0, TARGET_SUM is 0, schedule must be all zeros, convolution[1] isn't strictly needed.</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>         <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Convolutions dictionary must contain the key '1' when N &gt; 0."</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> objective(trial: optuna.trial.Trial) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> [trial.suggest_int(<span class="ss">f"x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="dv">0</span>, N) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(T)]</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        current_sum <span class="op">=</span> <span class="bu">sum</span>(X)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current_sum <span class="op">!=</span> N:</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            message <span class="op">=</span> <span class="ss">f"Constraint sum(X) == </span><span class="sc">{</span>N<span class="sc">}</span><span class="ss"> violated (sum=</span><span class="sc">{</span>current_sum<span class="sc">}</span><span class="ss">, X=</span><span class="sc">{</span>X<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> optuna.exceptions.TrialPruned(message)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>            ewt, esp <span class="op">=</span> calculate_objective_serv_time_lookup(schedule<span class="op">=</span>X, d<span class="op">=</span>d, convolutions<span class="op">=</span>convolutions)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>(<span class="ss">f"Error during evaluation for schedule </span><span class="sc">{</span>X<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>             <span class="cf">raise</span> optuna.exceptions.TrialPruned(<span class="ss">f"Evaluation failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Prune on eval error</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        objective_value <span class="op">=</span> w <span class="op">*</span> ewt <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> w) <span class="op">*</span> esp</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> objective_value</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> objective</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create the specific objective function instance using derived T and N</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>objective_func <span class="op">=</span> create_objective(</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    LIST_LENGTH,         <span class="co"># Derived T</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    TARGET_SUM,          <span class="co"># Derived N</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    DURATION_THRESHOLD,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    convolutions,   <span class="co"># Generated based on derived N</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    WEIGHT</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create an Optuna study object</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>)</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. **** Enqueue the starting trial ****</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert x_star list into the parameter dictionary format</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>initial_params <span class="op">=</span> {<span class="ss">f"x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>: x_star[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(LIST_LENGTH)}</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Enqueuing starting schedule: </span><span class="sc">{</span>x_star<span class="sc">}</span><span class="ss"> (Params: </span><span class="sc">{</span>initial_params<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>study.enqueue_trial(initial_params)</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Run the optimization</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="co"># n_trials specifies the number of *new* trials Optuna runs *after* the enqueued ones.</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>n_trials_to_run <span class="op">=</span> <span class="dv">99</span> <span class="co"># If you want 500 total evaluations, run 499 new ones after the enqueued trial.</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Starting optimization..."</span>)</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Derived Parameters: T=</span><span class="sc">{</span>LIST_LENGTH<span class="sc">}</span><span class="ss">, N=</span><span class="sc">{</span>TARGET_SUM<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Fixed Parameters: d=</span><span class="sc">{</span>DURATION_THRESHOLD<span class="sc">}</span><span class="ss">, w=</span><span class="sc">{</span>WEIGHT<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Attempting </span><span class="sc">{</span>n_trials_to_run<span class="sc">}</span><span class="ss"> new trials (plus 1 enqueued trial)..."</span>)</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optuna will first run the enqueued trial(s), then sample n_trials_to_run more.</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    study.optimize(objective_func, n_trials<span class="op">=</span>n_trials_to_run)</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">An error occurred during optimization: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import traceback</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># traceback.print_exc()</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>end_time <span class="op">=</span> time.time()</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Optimization finished in </span><span class="sc">{</span>end_time <span class="op">-</span> start_time<span class="sc">:.2f}</span><span class="ss"> seconds."</span>)</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Get the results and report trial states</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Results ---"</span>)</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="co"># The total number of trials will be n_trials_to_run + number of enqueued trials</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of trials run: </span><span class="sc">{</span><span class="bu">len</span>(study.trials)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>completed_trials <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> study.trials <span class="cf">if</span> t.state <span class="op">==</span> optuna.trial.TrialState.COMPLETE]</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>pruned_trials <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> study.trials <span class="cf">if</span> t.state <span class="op">==</span> optuna.trial.TrialState.PRUNED]</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>failed_trials <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> study.trials <span class="cf">if</span> t.state <span class="op">==</span> optuna.trial.TrialState.FAIL]</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Successfully completed trials: </span><span class="sc">{</span><span class="bu">len</span>(completed_trials)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Pruned trials: </span><span class="sc">{</span><span class="bu">len</span>(pruned_trials)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Failed trials: </span><span class="sc">{</span><span class="bu">len</span>(failed_trials)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if any trial completed successfully (including the enqueued one)</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> completed_trials:</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>    best_trial <span class="op">=</span> study.best_trial</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>    best_parameters_optuna <span class="op">=</span> best_trial.params</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>    best_value_optuna <span class="op">=</span> best_trial.value</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reconstruct the list X from the best parameters dictionary</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>    best_X <span class="op">=</span> [best_parameters_optuna.get(<span class="ss">f'x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>, <span class="dv">0</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(LIST_LENGTH)] <span class="co"># Use .get for safety</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Best trial found (among completed):"</span>)</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Trial Number: </span><span class="sc">{</span>best_trial<span class="sc">.</span>number<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'(Enqueued Initial Schedule)'</span> <span class="cf">if</span> best_trial<span class="sc">.</span>number <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">''</span><span class="sc">}</span><span class="ss">"</span>) <span class="co"># Check if best was trial 0</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Objective Value (w*ewt + (1-w)*esp): </span><span class="sc">{</span>best_value_optuna<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Parameters (Schedule X): </span><span class="sc">{</span>best_X<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Constraint check (Sum(X)): </span><span class="sc">{</span><span class="bu">sum</span>(best_X)<span class="sc">}</span><span class="ss"> (should be </span><span class="sc">{</span>TARGET_SUM<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optional: Recalculate ewt and esp for the best schedule</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure using the correct convolutions dict</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>        best_ewt, best_esp <span class="op">=</span> calculate_objective_serv_time_lookup(best_X, DURATION_THRESHOLD, convolutions)</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Components:"</span>)</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    - EWT (Expected Wait Time): </span><span class="sc">{</span>best_ewt<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    - ESP (Expected Spillover): </span><span class="sc">{</span>best_esp<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>        recalculated_value <span class="op">=</span> WEIGHT <span class="op">*</span> best_ewt <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> WEIGHT) <span class="op">*</span> best_esp</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    - Recalculated Objective: </span><span class="sc">{</span>recalculated_value<span class="sc">:.4f}</span><span class="ss"> (should match Best Value)"</span>)</span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Could not recalculate EWT/ESP for the best trial: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This case is less likely now, as the enqueued trial should run unless IT fails evaluation.</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">No trials completed successfully (including the enqueued starting schedule)."</span>)</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> failed_trials:</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="ss">f"  Check the error messages for Trial 0 (the enqueued trial) and others."</span>)</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pruned_trials <span class="kw">and</span> pruned_trials[<span class="dv">0</span>].number <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="ss">f"  The enqueued trial was pruned. Reason: </span><span class="sc">{</span>pruned_trials[<span class="dv">0</span>]<span class="sc">.</span>intermediate_values<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Or check logs</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Consider:"</span>)</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - Verifying the 'calculate_objective_serv_time_lookup' works correctly for x_star."</span>)</span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - Ensuring 'convolutions_data' is generated correctly for N=</span><span class="sc">{</span>TARGET_SUM<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - Increasing n_trials if the search space is complex."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-04-30 20:53:19,650] A new study created in memory with name: no-name-e0e9a17c-48db-4f57-a083-8f98b95834a9
[I 2025-04-30 20:53:19,655] Trial 0 finished with value: 55.00340243729603 and parameters: {'x_0': 2, 'x_1': 1, 'x_2': 0, 'x_3': 1, 'x_4': 1, 'x_5': 0, 'x_6': 1, 'x_7': 6}. Best is trial 0 with value: 55.00340243729603.
[I 2025-04-30 20:53:19,658] Trial 1 pruned. Constraint sum(X) == 12 violated (sum=42, X=[1, 10, 3, 2, 5, 8, 1, 12])
[I 2025-04-30 20:53:19,660] Trial 2 pruned. Constraint sum(X) == 12 violated (sum=31, X=[0, 3, 7, 2, 2, 5, 0, 12])
[I 2025-04-30 20:53:19,662] Trial 3 pruned. Constraint sum(X) == 12 violated (sum=72, X=[11, 10, 4, 10, 10, 9, 8, 10])
[I 2025-04-30 20:53:19,665] Trial 4 pruned. Constraint sum(X) == 12 violated (sum=65, X=[12, 5, 11, 9, 10, 5, 10, 3])
[I 2025-04-30 20:53:19,668] Trial 5 pruned. Constraint sum(X) == 12 violated (sum=55, X=[8, 8, 8, 9, 1, 0, 9, 12])
[I 2025-04-30 20:53:19,670] Trial 6 pruned. Constraint sum(X) == 12 violated (sum=26, X=[8, 3, 2, 0, 7, 1, 5, 0])
[I 2025-04-30 20:53:19,673] Trial 7 pruned. Constraint sum(X) == 12 violated (sum=39, X=[8, 4, 0, 9, 4, 12, 1, 1])
[I 2025-04-30 20:53:19,676] Trial 8 pruned. Constraint sum(X) == 12 violated (sum=59, X=[2, 7, 12, 5, 12, 2, 9, 10])
[I 2025-04-30 20:53:19,678] Trial 9 pruned. Constraint sum(X) == 12 violated (sum=57, X=[6, 4, 10, 11, 6, 12, 6, 2])
[I 2025-04-30 20:53:19,714] Trial 10 pruned. Constraint sum(X) == 12 violated (sum=20, X=[3, 0, 0, 5, 0, 3, 3, 6])
[I 2025-04-30 20:53:19,747] Trial 11 pruned. Constraint sum(X) == 12 violated (sum=39, X=[0, 12, 4, 2, 4, 8, 3, 6])
[I 2025-04-30 20:53:19,779] Trial 12 pruned. Constraint sum(X) == 12 violated (sum=27, X=[3, 0, 3, 0, 3, 8, 2, 8])
[I 2025-04-30 20:53:19,811] Trial 13 pruned. Constraint sum(X) == 12 violated (sum=39, X=[5, 9, 2, 3, 6, 10, 0, 4])
[I 2025-04-30 20:53:19,845] Trial 14 pruned. Constraint sum(X) == 12 violated (sum=40, X=[2, 12, 5, 3, 0, 6, 4, 8])
[I 2025-04-30 20:53:19,878] Trial 15 pruned. Constraint sum(X) == 12 violated (sum=40, X=[4, 10, 1, 6, 8, 4, 2, 5])
[I 2025-04-30 20:53:19,913] Trial 16 pruned. Constraint sum(X) == 12 violated (sum=47, X=[1, 7, 6, 1, 4, 8, 12, 8])
[I 2025-04-30 20:53:19,947] Trial 17 pruned. Constraint sum(X) == 12 violated (sum=37, X=[1, 2, 2, 4, 2, 10, 7, 9])
[I 2025-04-30 20:53:19,980] Trial 18 pruned. Constraint sum(X) == 12 violated (sum=32, X=[4, 6, 0, 1, 5, 7, 5, 4])
[I 2025-04-30 20:53:20,014] Trial 19 pruned. Constraint sum(X) == 12 violated (sum=33, X=[6, 1, 3, 7, 8, 0, 1, 7])
[I 2025-04-30 20:53:20,047] Trial 20 pruned. Constraint sum(X) == 12 violated (sum=37, X=[0, 10, 5, 3, 2, 3, 3, 11])
[I 2025-04-30 20:53:20,082] Trial 21 pruned. Constraint sum(X) == 12 violated (sum=31, X=[0, 2, 7, 2, 2, 6, 0, 12])
[I 2025-04-30 20:53:20,117] Trial 22 pruned. Constraint sum(X) == 12 violated (sum=33, X=[2, 3, 8, 1, 3, 5, 0, 11])
[I 2025-04-30 20:53:20,157] Trial 23 pruned. Constraint sum(X) == 12 violated (sum=34, X=[1, 1, 8, 2, 1, 10, 1, 10])
[I 2025-04-30 20:53:20,188] Trial 24 pruned. Constraint sum(X) == 12 violated (sum=34, X=[3, 5, 6, 4, 1, 2, 2, 11])
[I 2025-04-30 20:53:20,222] Trial 25 pruned. Constraint sum(X) == 12 violated (sum=35, X=[0, 2, 9, 0, 5, 7, 0, 12])
[I 2025-04-30 20:53:20,257] Trial 26 pruned. Constraint sum(X) == 12 violated (sum=34, X=[1, 4, 4, 7, 3, 4, 4, 7])
[I 2025-04-30 20:53:20,293] Trial 27 pruned. Constraint sum(X) == 12 violated (sum=21, X=[4, 0, 1, 4, 0, 1, 2, 9])
[I 2025-04-30 20:53:20,328] Trial 28 pruned. Constraint sum(X) == 12 violated (sum=27, X=[2, 1, 5, 2, 5, 6, 1, 5])
[I 2025-04-30 20:53:20,365] Trial 29 pruned. Constraint sum(X) == 12 violated (sum=60, X=[10, 11, 3, 12, 2, 9, 4, 9])
[I 2025-04-30 20:53:20,402] Trial 30 pruned. Constraint sum(X) == 12 violated (sum=46, X=[1, 8, 7, 1, 10, 11, 1, 7])
[I 2025-04-30 20:53:20,439] Trial 31 pruned. Constraint sum(X) == 12 violated (sum=72, X=[12, 11, 4, 8, 10, 9, 8, 10])
[I 2025-04-30 20:53:20,478] Trial 32 pruned. Constraint sum(X) == 12 violated (sum=77, X=[11, 9, 6, 10, 12, 7, 10, 12])
[I 2025-04-30 20:53:20,516] Trial 33 pruned. Constraint sum(X) == 12 violated (sum=65, X=[9, 8, 1, 12, 8, 9, 7, 11])
[I 2025-04-30 20:53:20,556] Trial 34 pruned. Constraint sum(X) == 12 violated (sum=60, X=[9, 5, 2, 10, 9, 1, 12, 12])
[I 2025-04-30 20:53:20,594] Trial 35 pruned. Constraint sum(X) == 12 violated (sum=60, X=[12, 10, 7, 0, 7, 5, 9, 10])
[I 2025-04-30 20:53:20,634] Trial 36 pruned. Constraint sum(X) == 12 violated (sum=48, X=[7, 3, 4, 5, 1, 11, 6, 11])
[I 2025-04-30 20:53:20,672] Trial 37 pruned. Constraint sum(X) == 12 violated (sum=58, X=[5, 7, 10, 8, 11, 8, 7, 2])
[I 2025-04-30 20:53:20,711] Trial 38 pruned. Constraint sum(X) == 12 violated (sum=43, X=[2, 6, 5, 3, 7, 0, 10, 10])
[I 2025-04-30 20:53:20,749] Trial 39 pruned. Constraint sum(X) == 12 violated (sum=69, X=[7, 9, 12, 6, 11, 4, 8, 12])
[I 2025-04-30 20:53:20,787] Trial 40 pruned. Constraint sum(X) == 12 violated (sum=37, X=[3, 11, 0, 10, 3, 2, 3, 5])
[I 2025-04-30 20:53:20,827] Trial 41 pruned. Constraint sum(X) == 12 violated (sum=59, X=[11, 3, 11, 9, 9, 5, 11, 0])
[I 2025-04-30 20:53:20,870] Trial 42 pruned. Constraint sum(X) == 12 violated (sum=61, X=[11, 5, 9, 11, 10, 3, 10, 2])
[I 2025-04-30 20:53:20,910] Trial 43 pruned. Constraint sum(X) == 12 violated (sum=58, X=[10, 4, 3, 11, 11, 7, 9, 3])
[I 2025-04-30 20:53:20,949] Trial 44 pruned. Constraint sum(X) == 12 violated (sum=63, X=[12, 4, 11, 9, 9, 6, 11, 1])
[I 2025-04-30 20:53:20,990] Trial 45 pruned. Constraint sum(X) == 12 violated (sum=43, X=[0, 6, 2, 9, 4, 11, 8, 3])
[I 2025-04-30 20:53:21,031] Trial 46 pruned. Constraint sum(X) == 12 violated (sum=55, X=[10, 12, 1, 1, 6, 8, 6, 11])
[I 2025-04-30 20:53:21,072] Trial 47 pruned. Constraint sum(X) == 12 violated (sum=47, X=[9, 2, 9, 8, 0, 12, 1, 6])
[I 2025-04-30 20:53:21,114] Trial 48 pruned. Constraint sum(X) == 12 violated (sum=38, X=[5, 8, 4, 2, 12, 3, 0, 4])
[I 2025-04-30 20:53:21,156] Trial 49 pruned. Constraint sum(X) == 12 violated (sum=37, X=[1, 1, 3, 5, 4, 9, 5, 9])
[I 2025-04-30 20:53:21,197] Trial 50 pruned. Constraint sum(X) == 12 violated (sum=62, X=[7, 7, 11, 6, 7, 10, 11, 3])
[I 2025-04-30 20:53:21,242] Trial 51 pruned. Constraint sum(X) == 12 violated (sum=58, X=[8, 10, 8, 10, 1, 0, 9, 12])
[I 2025-04-30 20:53:21,285] Trial 52 pruned. Constraint sum(X) == 12 violated (sum=43, X=[11, 9, 7, 3, 1, 2, 2, 8])
[I 2025-04-30 20:53:21,326] Trial 53 pruned. Constraint sum(X) == 12 violated (sum=57, X=[8, 8, 6, 11, 2, 1, 9, 12])
[I 2025-04-30 20:53:21,367] Trial 54 pruned. Constraint sum(X) == 12 violated (sum=46, X=[0, 11, 12, 7, 0, 0, 10, 6])
[I 2025-04-30 20:53:21,406] Trial 55 pruned. Constraint sum(X) == 12 violated (sum=45, X=[6, 9, 10, 1, 3, 5, 0, 11])
[I 2025-04-30 20:53:21,447] Trial 56 pruned. Constraint sum(X) == 12 violated (sum=52, X=[12, 10, 8, 0, 5, 4, 3, 10])
[I 2025-04-30 20:53:21,491] Trial 57 pruned. Constraint sum(X) == 12 violated (sum=47, X=[2, 5, 5, 8, 2, 6, 8, 11])
[I 2025-04-30 20:53:21,535] Trial 58 pruned. Constraint sum(X) == 12 violated (sum=24, X=[1, 2, 0, 4, 1, 1, 7, 8])
[I 2025-04-30 20:53:21,578] Trial 59 pruned. Constraint sum(X) == 12 violated (sum=33, X=[3, 0, 6, 2, 8, 8, 2, 4])
[I 2025-04-30 20:53:21,621] Trial 60 pruned. Constraint sum(X) == 12 violated (sum=34, X=[0, 3, 2, 10, 0, 7, 0, 12])
[I 2025-04-30 20:53:21,664] Trial 61 pruned. Constraint sum(X) == 12 violated (sum=26, X=[10, 4, 1, 0, 10, 0, 1, 0])
[I 2025-04-30 20:53:21,708] Trial 62 pruned. Constraint sum(X) == 12 violated (sum=26, X=[9, 1, 2, 1, 6, 1, 1, 5])
[I 2025-04-30 20:53:21,752] Trial 63 pruned. Constraint sum(X) == 12 violated (sum=31, X=[8, 3, 3, 2, 2, 0, 4, 9])
[I 2025-04-30 20:53:21,795] Trial 64 pruned. Constraint sum(X) == 12 violated (sum=27, X=[6, 6, 4, 0, 4, 1, 6, 0])
[I 2025-04-30 20:53:21,858] Trial 65 pruned. Constraint sum(X) == 12 violated (sum=43, X=[11, 12, 2, 1, 9, 2, 5, 1])
[I 2025-04-30 20:53:21,916] Trial 66 pruned. Constraint sum(X) == 12 violated (sum=47, X=[5, 2, 7, 9, 5, 4, 8, 7])
[I 2025-04-30 20:53:21,969] Trial 67 pruned. Constraint sum(X) == 12 violated (sum=53, X=[7, 7, 0, 3, 11, 5, 10, 10])
[I 2025-04-30 20:53:22,014] Trial 68 pruned. Constraint sum(X) == 12 violated (sum=38, X=[4, 11, 1, 0, 1, 9, 0, 12])
[I 2025-04-30 20:53:22,059] Trial 69 pruned. Constraint sum(X) == 12 violated (sum=36, X=[1, 5, 5, 2, 3, 0, 9, 11])
[I 2025-04-30 20:53:22,104] Trial 70 pruned. Constraint sum(X) == 12 violated (sum=41, X=[12, 0, 3, 11, 8, 2, 3, 2])
[I 2025-04-30 20:53:22,147] Trial 71 pruned. Constraint sum(X) == 12 violated (sum=38, X=[9, 3, 0, 9, 4, 12, 1, 0])
[I 2025-04-30 20:53:22,191] Trial 72 pruned. Constraint sum(X) == 12 violated (sum=40, X=[8, 4, 1, 8, 6, 10, 2, 1])
[I 2025-04-30 20:53:22,235] Trial 73 pruned. Constraint sum(X) == 12 violated (sum=36, X=[8, 5, 0, 10, 5, 6, 1, 1])
[I 2025-04-30 20:53:22,279] Trial 74 pruned. Constraint sum(X) == 12 violated (sum=54, X=[10, 4, 9, 9, 7, 12, 2, 1])
[I 2025-04-30 20:53:22,324] Trial 75 pruned. Constraint sum(X) == 12 violated (sum=38, X=[7, 6, 1, 7, 3, 11, 1, 2])
[I 2025-04-30 20:53:22,370] Trial 76 pruned. Constraint sum(X) == 12 violated (sum=23, X=[1, 10, 2, 1, 2, 7, 0, 0])
[I 2025-04-30 20:53:22,411] Trial 77 pruned. Constraint sum(X) == 12 violated (sum=40, X=[0, 3, 4, 12, 6, 1, 11, 3])
[I 2025-04-30 20:53:22,454] Trial 78 pruned. Constraint sum(X) == 12 violated (sum=61, X=[6, 2, 6, 10, 10, 3, 12, 12])
[I 2025-04-30 20:53:22,499] Trial 79 pruned. Constraint sum(X) == 12 violated (sum=56, X=[12, 4, 8, 4, 1, 10, 7, 10])
[I 2025-04-30 20:53:22,546] Trial 80 pruned. Constraint sum(X) == 12 violated (sum=55, X=[2, 8, 3, 9, 5, 7, 10, 11])
[I 2025-04-30 20:53:22,588] Trial 81 pruned. Constraint sum(X) == 12 violated (sum=55, X=[3, 7, 12, 3, 12, 1, 9, 8])
[I 2025-04-30 20:53:22,629] Trial 82 pruned. Constraint sum(X) == 12 violated (sum=62, X=[2, 9, 11, 5, 12, 2, 9, 12])
[I 2025-04-30 20:53:22,670] Trial 83 pruned. Constraint sum(X) == 12 violated (sum=59, X=[1, 6, 12, 6, 11, 8, 8, 7])
[I 2025-04-30 20:53:22,714] Trial 84 pruned. Constraint sum(X) == 12 violated (sum=48, X=[11, 7, 11, 8, 4, 0, 2, 5])
[I 2025-04-30 20:53:22,760] Trial 85 pruned. Constraint sum(X) == 12 violated (sum=43, X=[4, 5, 10, 2, 2, 4, 5, 11])
[I 2025-04-30 20:53:22,804] Trial 86 pruned. Constraint sum(X) == 12 violated (sum=32, X=[0, 8, 12, 1, 0, 5, 0, 6])
[I 2025-04-30 20:53:22,849] Trial 87 pruned. Constraint sum(X) == 12 violated (sum=44, X=[2, 1, 5, 0, 11, 6, 10, 9])
[I 2025-04-30 20:53:22,894] Trial 88 pruned. Constraint sum(X) == 12 violated (sum=50, X=[9, 3, 7, 9, 1, 3, 8, 10])
[I 2025-04-30 20:53:22,940] Trial 89 pruned. Constraint sum(X) == 12 violated (sum=47, X=[8, 10, 0, 7, 9, 0, 1, 12])
[I 2025-04-30 20:53:22,988] Trial 90 pruned. Constraint sum(X) == 12 violated (sum=45, X=[1, 9, 10, 4, 10, 9, 0, 2])
[I 2025-04-30 20:53:23,033] Trial 91 pruned. Constraint sum(X) == 12 violated (sum=54, X=[3, 4, 11, 11, 6, 12, 6, 1])
[I 2025-04-30 20:53:23,078] Trial 92 pruned. Constraint sum(X) == 12 violated (sum=48, X=[7, 4, 9, 11, 7, 1, 5, 4])
[I 2025-04-30 20:53:23,120] Trial 93 pruned. Constraint sum(X) == 12 violated (sum=56, X=[5, 5, 8, 12, 5, 12, 6, 3])
[I 2025-04-30 20:53:23,162] Trial 94 pruned. Constraint sum(X) == 12 violated (sum=61, X=[10, 3, 11, 10, 7, 11, 7, 2])
[I 2025-04-30 20:53:23,206] Trial 95 pruned. Constraint sum(X) == 12 violated (sum=56, X=[2, 4, 10, 11, 8, 11, 9, 1])
[I 2025-04-30 20:53:23,253] Trial 96 pruned. Constraint sum(X) == 12 violated (sum=60, X=[12, 5, 12, 10, 6, 0, 4, 11])
[I 2025-04-30 20:53:23,294] Trial 97 pruned. Constraint sum(X) == 12 violated (sum=50, X=[11, 6, 2, 1, 12, 8, 10, 0])
[I 2025-04-30 20:53:23,337] Trial 98 pruned. Constraint sum(X) == 12 violated (sum=61, X=[6, 11, 4, 8, 3, 10, 7, 12])</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Enqueuing starting schedule: [2 1 0 1 1 0 1 6] (Params: {'x_0': 2, 'x_1': 1, 'x_2': 0, 'x_3': 1, 'x_4': 1, 'x_5': 0, 'x_6': 1, 'x_7': 6})

Starting optimization...
Derived Parameters: T=8, N=12
Fixed Parameters: d=5, w=0.1
Attempting 99 new trials (plus 1 enqueued trial)...
Optimization finished in 3.69 seconds.

--- Results ---
Total number of trials run: 99
  Successfully completed trials: 1
  Pruned trials: 98
  Failed trials: 0

Best trial found (among completed):
  Trial Number: 0 (Enqueued Initial Schedule)
  Objective Value (w*ewt + (1-w)*esp): 55.0034
  Parameters (Schedule X): [2, 1, 0, 1, 1, 0, 1, 6]
  Constraint check (Sum(X)): 12 (should be 12)
  Components:
    - EWT (Expected Wait Time): 176.8565
    - ESP (Expected Spillover): 41.4642
    - Recalculated Objective: 55.0034 (should match Best Value)</code></pre>
</div>
</div>
<p>From the output it is clear that the algorithm although working properly, is not able to find a better solution than the initial one. This is because in it’s search it has to check a large number of unfeasable solutions. A lot of trials have to be discarded because they violate the constraint of <span class="math inline">\(\mathbf{x} = N\)</span>.</p>
<p>To circumvent this, we can use the perturbation vectors <span class="math inline">\(v_i\)</span> to create a new schedule <span class="math inline">\(\mathbf{x}^*\)</span> that is close to the initial schedule <span class="math inline">\(\mathbf{x}\)</span>, but not equal to it. This new schedule will be used as the starting point for the optimization. The number of unfeasable solutions now is limited to the cases that a new trial contains negative values.</p>
<p>Effectively the model now learns to manipulate the first derivative of the objective function. The following code implements this approach. Again we are not exploring all solutions, just the neighborhood of the initial solution. The code is similar to the previous one, but now we are using the perturbation vectors to create a new schedule <span class="math inline">\(\mathbf{x}'\)</span>.</p>
<div id="adbc490b" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Optuna Configuration Variables ---</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>x_star <span class="op">=</span> np.array(x_star)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>duration_threshold <span class="op">=</span> d <span class="co"># Use 'd' from initialization</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> w             <span class="co"># Use 'w' from initialization</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>conv_dict <span class="op">=</span> convolutions <span class="co"># Use 'convolutions' from initialization</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>num_u_variables <span class="op">=</span> v_star.shape[<span class="dv">0</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Optuna Objective Factory Function</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_objective(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    initial_x_star: np.ndarray,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    modification_v_star: np.ndarray,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    objective_weight: <span class="bu">float</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    slot_duration: <span class="bu">int</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    conv_dict: Dict[<span class="bu">int</span>, np.ndarray]</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Callable[[optuna.trial.Trial], <span class="bu">float</span>]:</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Creates the objective function for Optuna, capturing problem parameters. """</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    internal_num_u <span class="op">=</span> modification_v_star.shape[<span class="dv">0</span>]</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> objective(trial: optuna.trial.Trial) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" The function Optuna minimizes. """</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Suggest u</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        U <span class="op">=</span> np.array([trial.suggest_int(<span class="ss">f"u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(internal_num_u)])</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        u_column <span class="op">=</span> U.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Calculate r_u</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        r_u <span class="op">=</span> modification_v_star <span class="op">*</span> u_column</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Sum r_u columns</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        r_u_col_sum <span class="op">=</span> np.<span class="bu">sum</span>(r_u, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Calculate neighbor</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        neighbor_schedule <span class="op">=</span> initial_x_star <span class="op">+</span> r_u_col_sum</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5. Constraint Check</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.<span class="bu">any</span>(neighbor_schedule <span class="op">&lt;</span> <span class="dv">0</span>):</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>            message <span class="op">=</span> <span class="ss">f"Constraint violation: Resulting schedule &lt; 0: </span><span class="sc">{</span>neighbor_schedule<span class="sc">}</span><span class="ss"> (u=</span><span class="sc">{</span>U<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> optuna.exceptions.TrialPruned(message)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 6. Evaluate</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>            ewt, esp <span class="op">=</span> calculate_objective_serv_time_lookup(</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>                schedule<span class="op">=</span>neighbor_schedule,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>                d<span class="op">=</span>slot_duration,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>                convolutions<span class="op">=</span>conv_dict</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Optional tracking</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># trial.set_user_attr("EWT", ewt)</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>            <span class="co"># trial.set_user_attr("ESP", esp)</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error during evaluation for schedule </span><span class="sc">{</span>neighbor_schedule<span class="sc">}</span><span class="ss"> (u=</span><span class="sc">{</span>U<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> optuna.exceptions.TrialPruned(<span class="ss">f"Evaluation failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 7. Calculate final objective</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>        objective_value <span class="op">=</span> objective_weight <span class="op">*</span> ewt <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> objective_weight) <span class="op">*</span> esp</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> objective_value</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> objective <span class="co"># Return the nested function</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Objective Instance &amp; Run Optuna Study</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create the specific objective function instance</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Starting Optuna Setup ---"</span>)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Creating Optuna objective function instance..."</span>)</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>objective_func <span class="op">=</span> create_objective(</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    initial_x_star<span class="op">=</span>x_star,             <span class="co"># Use generated x_star (NumPy array)</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    modification_v_star<span class="op">=</span>v_star,        <span class="co"># Use generated v_star</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    objective_weight<span class="op">=</span>weight,           <span class="co"># Use defined w</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    slot_duration<span class="op">=</span>duration_threshold,  <span class="co"># Use defined d</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    conv_dict<span class="op">=</span>conv_dict                <span class="co"># Use generated convolutions</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Objective function created."</span>)</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create Optuna study</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>, study_name<span class="op">=</span><span class="st">"Schedule_Opt_BW_Init"</span>)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Optuna study '</span><span class="sc">{</span>study<span class="sc">.</span>study_name<span class="sc">}</span><span class="ss">' created."</span>)</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Enqueue starting trial (U=0) - Use correct length: num_u_variables</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>initial_params <span class="op">=</span> {<span class="ss">f"u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>: <span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_u_variables)}</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Enqueuing starting trial (u=all zeros):"</span>)</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Initial x_star evaluated: </span><span class="sc">{</span>x_star<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Enqueued Params (len=</span><span class="sc">{</span><span class="bu">len</span>(initial_params)<span class="sc">}</span><span class="ss"> based on v_star rows): </span><span class="sc">{</span>initial_params<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>study.enqueue_trial(initial_params)</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Run Optimization</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>n_trials_to_run <span class="op">=</span> <span class="dv">99</span> <span class="co"># Example: 99 new trials + 1 enqueued = 100 total</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Starting optimization run..."</span>)</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Attempting </span><span class="sc">{</span>n_trials_to_run<span class="sc">}</span><span class="ss"> new trials (plus </span><span class="sc">{</span><span class="bu">len</span>(study.trials)<span class="sc">}</span><span class="ss"> enqueued)..."</span>)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>    study.optimize(objective_func, n_trials<span class="op">=</span>n_trials_to_run)</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Optimization stopped manually."</span>)</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">An unexpected error occurred during optimization: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># import traceback</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># traceback.print_exc() # Uncomment for detailed error</span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a><span class="cf">finally</span>:</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>    end_time <span class="op">=</span> time.time()</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Optimization process finished in </span><span class="sc">{</span>end_time <span class="op">-</span> start_time<span class="sc">:.2f}</span><span class="ss"> seconds."</span>)</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Get and Display Results</span></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Optimization Results ---"</span>)</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of trials in study: </span><span class="sc">{</span><span class="bu">len</span>(study.trials)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>completed_trials <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> study.trials <span class="cf">if</span> t.state <span class="op">==</span> optuna.trial.TrialState.COMPLETE]</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>pruned_trials <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> study.trials <span class="cf">if</span> t.state <span class="op">==</span> optuna.trial.TrialState.PRUNED]</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>failed_trials <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> study.trials <span class="cf">if</span> t.state <span class="op">==</span> optuna.trial.TrialState.FAIL]</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Successfully completed trials: </span><span class="sc">{</span><span class="bu">len</span>(completed_trials)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Pruned trials (Constraint/Eval Fail): </span><span class="sc">{</span><span class="bu">len</span>(pruned_trials)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Failed trials (Other Errors): </span><span class="sc">{</span><span class="bu">len</span>(failed_trials)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> completed_trials:</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>    best_trial <span class="op">=</span> study.best_trial</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>    best_params_u <span class="op">=</span> best_trial.params</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>    best_value_optuna <span class="op">=</span> best_trial.value</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reconstruct best 'u' array using num_u_variables</span></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>    best_u_list <span class="op">=</span> [best_params_u.get(<span class="ss">f'u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>, <span class="dv">0</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_u_variables)]</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>    best_u_np <span class="op">=</span> np.array(best_u_list)</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the best neighbor schedule</span></span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>    best_u_column <span class="op">=</span> best_u_np.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>    best_r_u <span class="op">=</span> v_star <span class="op">*</span> best_u_column</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>    best_r_u_col_sum <span class="op">=</span> np.<span class="bu">sum</span>(best_r_u, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>    best_neighbor_schedule <span class="op">=</span> x_star <span class="op">+</span> best_r_u_col_sum</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Best trial found (Trial #</span><span class="sc">{</span>best_trial<span class="sc">.</span>number<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the best trial was the enqueued one</span></span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> best_trial.number <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"  (This was the initial enqueued trial)"</span>)</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Objective Value: </span><span class="sc">{</span>best_value_optuna<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Best Z parameters (len=</span><span class="sc">{</span><span class="bu">len</span>(best_u_list)<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>best_u_list<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Corresponding Best Schedule: </span><span class="sc">{</span>best_neighbor_schedule<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Show as int</span></span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Sum of Best Schedule: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(best_neighbor_schedule)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optional: Recalculate EWT/ESP for verification</span></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>        best_ewt, best_esp <span class="op">=</span> calculate_objective_serv_time_lookup(</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>            schedule<span class="op">=</span>best_neighbor_schedule,</span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>            d<span class="op">=</span>duration_threshold,</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>            convolutions<span class="op">=</span>conv_dict</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>        recalculated_value <span class="op">=</span> weight <span class="op">*</span> best_ewt <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> weight) <span class="op">*</span> best_esp</span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Verification Components:"</span>)</span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    - EWT: </span><span class="sc">{</span>best_ewt<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    - ESP: </span><span class="sc">{</span>best_esp<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    - Recalculated Objective: </span><span class="sc">{</span>recalculated_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Could not recalculate EWT/ESP for the best trial: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> pruned_trials <span class="kw">or</span> failed_trials:</span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">No trials completed successfully."</span>)</span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> study.trials: <span class="co"># Check if list is not empty</span></span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a>         initial_trial <span class="op">=</span> study.trials[<span class="dv">0</span>]</span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="ss">f"  Status of Trial 0 (Enqueued): </span><span class="sc">{</span>initial_trial<span class="sc">.</span>state<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> initial_trial.state <span class="op">==</span> optuna.trial.TrialState.PRUNED:</span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a>              <span class="bu">print</span>(<span class="ss">f"  Trial 0 pruned, check logs for constraint violation or evaluation errors."</span>)</span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a>         <span class="cf">elif</span> initial_trial.state <span class="op">==</span> optuna.trial.TrialState.FAIL:</span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>              <span class="bu">print</span>(<span class="ss">f"  Trial 0 failed, check error messages during optimization run."</span>)</span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  Consider checking function implementations and constraints."</span>)</span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>     <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">No trials were run or recorded in the study."</span>)</span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- End of Script ---"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-04-30 20:53:23,395] A new study created in memory with name: Schedule_Opt_BW_Init
[I 2025-04-30 20:53:23,399] Trial 0 finished with value: 55.00340243729603 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0}. Best is trial 0 with value: 55.00340243729603.
[I 2025-04-30 20:53:23,403] Trial 1 finished with value: 55.224696537304126 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1}. Best is trial 0 with value: 55.00340243729603.
[I 2025-04-30 20:53:23,405] Trial 2 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1 -1  1  2 -1  2  6] (u=[1 1 1 0 0 1 0 1])
[I 2025-04-30 20:53:23,407] Trial 3 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  2  0  0  2 -1  2  5] (u=[0 0 1 1 0 1 0 1])
[I 2025-04-30 20:53:23,410] Trial 4 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  1  1 -1  1  6] (u=[0 1 0 1 1 1 0 0])
[I 2025-04-30 20:53:23,412] Trial 5 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,415] Trial 6 finished with value: 56.11827913221487 and parameters: {'u_0': 1, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 0, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,418] Trial 7 finished with value: 58.124803199493925 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 1, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,421] Trial 8 finished with value: 57.1995807302867 and parameters: {'u_0': 1, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,423] Trial 9 finished with value: 58.304361197076524 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 0}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,457] Trial 10 finished with value: 55.86345059495974 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 1, 'u_6': 1, 'u_7': 0}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,488] Trial 11 finished with value: 54.93975707062047 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 0}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,520] Trial 12 finished with value: 55.3794133749373 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 0}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,553] Trial 13 finished with value: 54.93975707062047 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 0}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,587] Trial 14 finished with value: 54.3527877987549 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,619] Trial 15 finished with value: 54.689558865006454 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,653] Trial 16 finished with value: 54.689558865006454 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,686] Trial 17 finished with value: 54.39992617147183 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 1, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,720] Trial 18 finished with value: 54.689558865006454 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,756] Trial 19 finished with value: 54.3527877987549 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,790] Trial 20 finished with value: 55.00340243729603 and parameters: {'u_0': 1, 'u_1': 1, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 1, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,826] Trial 21 finished with value: 54.3527877987549 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,863] Trial 22 finished with value: 54.3527877987549 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,906] Trial 23 finished with value: 54.3527877987549 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,943] Trial 24 finished with value: 54.3527877987549 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:23,981] Trial 25 finished with value: 54.3527877987549 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,019] Trial 26 finished with value: 54.3527877987549 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,056] Trial 27 finished with value: 54.3527877987549 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,091] Trial 28 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,125] Trial 29 finished with value: 55.36748711590873 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,158] Trial 30 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,192] Trial 31 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,227] Trial 32 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,259] Trial 33 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,291] Trial 34 finished with value: 55.62911283499102 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,326] Trial 35 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,356] Trial 36 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  0  2 -1  2  5] (u=[0 1 0 1 0 1 0 1])
[I 2025-04-30 20:53:24,387] Trial 37 finished with value: 55.47250320108782 and parameters: {'u_0': 1, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,418] Trial 38 finished with value: 54.343751324859056 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 0, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,448] Trial 39 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  1 -1  2  5] (u=[0 1 0 0 1 1 0 1])
[I 2025-04-30 20:53:24,480] Trial 40 finished with value: 57.28625982617569 and parameters: {'u_0': 1, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 0}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,512] Trial 41 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,543] Trial 42 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,576] Trial 43 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,608] Trial 44 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,641] Trial 45 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,676] Trial 46 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,711] Trial 47 finished with value: 55.3794133749373 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 0}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,744] Trial 48 finished with value: 54.343751324859056 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 0, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,779] Trial 49 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,816] Trial 50 finished with value: 55.47250320108782 and parameters: {'u_0': 1, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,852] Trial 51 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,889] Trial 52 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,925] Trial 53 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,961] Trial 54 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:24,999] Trial 55 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,036] Trial 56 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,073] Trial 57 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,111] Trial 58 finished with value: 54.68627187607794 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,149] Trial 59 finished with value: 55.48748512908859 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 1, 'u_6': 1, 'u_7': 0}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,187] Trial 60 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,224] Trial 61 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,261] Trial 62 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,301] Trial 63 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,338] Trial 64 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,375] Trial 65 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,414] Trial 66 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,453] Trial 67 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,490] Trial 68 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,527] Trial 69 finished with value: 55.62911283499102 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,565] Trial 70 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,603] Trial 71 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,642] Trial 72 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,681] Trial 73 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,717] Trial 74 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,752] Trial 75 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,787] Trial 76 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,828] Trial 77 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,867] Trial 78 finished with value: 54.343751324859056 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 0, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,905] Trial 79 finished with value: 55.47250320108782 and parameters: {'u_0': 1, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,942] Trial 80 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:25,980] Trial 81 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,020] Trial 82 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,062] Trial 83 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,099] Trial 84 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,137] Trial 85 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,175] Trial 86 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,213] Trial 87 finished with value: 54.38093433022728 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 1, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,255] Trial 88 finished with value: 54.68627187607794 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,294] Trial 89 finished with value: 55.18486420621119 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 0}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,334] Trial 90 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,373] Trial 91 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,411] Trial 92 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,448] Trial 93 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,485] Trial 94 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,523] Trial 95 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,564] Trial 96 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,600] Trial 97 finished with value: 54.32519391310184 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.
[I 2025-04-30 20:53:26,641] Trial 98 finished with value: 55.62911283499102 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1}. Best is trial 5 with value: 54.32519391310184.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Starting Optuna Setup ---
Creating Optuna objective function instance...
Objective function created.
Optuna study 'Schedule_Opt_BW_Init' created.

Enqueuing starting trial (u=all zeros):
  Initial x_star evaluated: [2 1 0 1 1 0 1 6]
  Enqueued Params (len=8 based on v_star rows): {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0}

Starting optimization run...
  Attempting 99 new trials (plus 1 enqueued)...
Optimization process finished in 3.24 seconds.

--- Optimization Results ---
Total number of trials in study: 99
  Successfully completed trials: 94
  Pruned trials (Constraint/Eval Fail): 5
  Failed trials (Other Errors): 0

Best trial found (Trial #5):
  Objective Value: 54.325194
  Best Z parameters (len=8): [0, 1, 0, 1, 1, 0, 1, 1]
  Corresponding Best Schedule: [3 0 1 1 0 1 1 5]
  Sum of Best Schedule: 12
  Verification Components:
    - EWT: 186.336874
    - ESP: 39.657229
    - Recalculated Objective: 54.325194

--- End of Script ---</code></pre>
</div>
</div>
<div id="ffd41c29" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> [<span class="ss">f"u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_u_variables)]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> optuna.visualization.plot_parallel_coordinate(study, params)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>                            <div id="e9c822ee-d799-4ad7-a80e-249dfa96db90" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("e9c822ee-d799-4ad7-a80e-249dfa96db90")) {                    Plotly.newPlot(                        "e9c822ee-d799-4ad7-a80e-249dfa96db90",                        [{"dimensions":[{"label":"Objective Value","range":[54.32519391310184,58.304361197076524],"values":[55.00340243729603,55.224696537304126,54.32519391310184,56.11827913221487,58.124803199493925,57.1995807302867,58.304361197076524,55.86345059495974,54.93975707062047,55.3794133749373,54.93975707062047,54.3527877987549,54.689558865006454,54.689558865006454,54.39992617147183,54.689558865006454,54.3527877987549,55.00340243729603,54.3527877987549,54.3527877987549,54.3527877987549,54.3527877987549,54.3527877987549,54.3527877987549,54.3527877987549,54.32519391310184,55.36748711590873,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,55.62911283499102,54.32519391310184,55.47250320108782,54.343751324859056,57.28625982617569,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,55.3794133749373,54.343751324859056,54.32519391310184,55.47250320108782,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.68627187607794,55.48748512908859,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,55.62911283499102,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.343751324859056,55.47250320108782,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.38093433022728,54.68627187607794,55.18486420621119,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,55.62911283499102]},{"label":"u_0","range":[0,1],"values":[0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"label":"u_1","range":[0,1],"values":[0,0,1,1,0,1,0,1,0,1,0,0,1,1,0,1,0,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},{"label":"u_2","range":[0,1],"values":[0,0,0,0,0,0,0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{"label":"u_3","range":[0,1],"values":[0,1,1,1,1,0,0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1]},{"label":"u_4","range":[0,1],"values":[0,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},{"label":"u_5","range":[0,1],"values":[0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0]},{"label":"u_6","range":[0,1],"values":[0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0]},{"label":"u_7","range":[0,1],"values":[0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1]}],"labelangle":30,"labelside":"bottom","line":{"color":[55.00340243729603,55.224696537304126,54.32519391310184,56.11827913221487,58.124803199493925,57.1995807302867,58.304361197076524,55.86345059495974,54.93975707062047,55.3794133749373,54.93975707062047,54.3527877987549,54.689558865006454,54.689558865006454,54.39992617147183,54.689558865006454,54.3527877987549,55.00340243729603,54.3527877987549,54.3527877987549,54.3527877987549,54.3527877987549,54.3527877987549,54.3527877987549,54.3527877987549,54.32519391310184,55.36748711590873,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,55.62911283499102,54.32519391310184,55.47250320108782,54.343751324859056,57.28625982617569,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,55.3794133749373,54.343751324859056,54.32519391310184,55.47250320108782,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.68627187607794,55.48748512908859,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,55.62911283499102,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.343751324859056,55.47250320108782,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.38093433022728,54.68627187607794,55.18486420621119,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,54.32519391310184,55.62911283499102],"colorbar":{"title":{"text":"Objective Value"}},"colorscale":[[0.0,"rgb(247,251,255)"],[0.125,"rgb(222,235,247)"],[0.25,"rgb(198,219,239)"],[0.375,"rgb(158,202,225)"],[0.5,"rgb(107,174,214)"],[0.625,"rgb(66,146,198)"],[0.75,"rgb(33,113,181)"],[0.875,"rgb(8,81,156)"],[1.0,"rgb(8,48,107)"]],"reversescale":true,"showscale":true},"type":"parcoords"}],                        {"title":{"text":"Parallel Coordinate Plot"},"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"},"margin":{"b":0,"l":0,"r":0,"t":30}}}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('e9c822ee-d799-4ad7-a80e-249dfa96db90');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>The results seem to indicate that the experiments are generating far less waste in the search space. Of the 99 trials <code>{python}len(completed_trials)</code> were completed. The algorithm ran for 3.2449679374694824 seconds and was able to find a better solution than the initial one.</p>
<p>In order to compute the optimal solution with real cost, we can use the local search algorithm. The following code implements this approach. It uses the <code>local_search</code> function to compute the optimal solution.</p>
<div id="902abc8b" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions <span class="im">import</span> local_search</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing optimal solution with real cost</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>test_x <span class="op">=</span> local_search(x_star, d, convolutions, w, v_star, T, echo<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> time.time()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time taken for local search: </span><span class="sc">{</span>end <span class="op">-</span> start<span class="sc">:.2f}</span><span class="ss"> seconds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initial solution: [2 1 0 1 1 0 1 6], cost: 55.00340243729603
Running local search with switching 1 patient(s)
Size of neighborhood: 6
Found better solution: [2 1 0 1 1 1 0 6], cost: 54.645612422757864
Running local search with switching 1 patient(s)
Size of neighborhood: 6
Found better solution: [2 1 0 1 1 1 1 5], cost: 54.04023936221597
Running local search with switching 1 patient(s)
Size of neighborhood: 7
Found better solution: [2 1 1 0 1 1 1 5], cost: 53.94729445871407
Running local search with switching 1 patient(s)
Size of neighborhood: 7
Running local search with switching 2 patient(s)
Size of neighborhood: 22
Running local search with switching 3 patient(s)
Size of neighborhood: 41
Running local search with switching 4 patient(s)
Size of neighborhood: 50
Running local search with switching 5 patient(s)
Size of neighborhood: 41
Running local search with switching 6 patient(s)
Size of neighborhood: 22
Running local search with switching 7 patient(s)
Size of neighborhood: 7
Time taken for local search: 0.04 seconds</code></pre>
</div>
</div>
<p>As we can see the Bayesion Optimization had not yet found the global optimum. The local search algorithm is able to find the optimal solution in a much smaller amount of time.</p>
<p>Now we will try a larger instance and use Bayesian Optimization to search for the optimal solution. We will let the Bayesian Optimization algorithm find and update the optimal solution. If it can’t find a better solution it will break and return the best solution. The following code implements this approach.</p>
<div id="a618dcfb" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">22</span> <span class="co"># Number of patients</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">20</span> <span class="co"># Number of intervals</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="dv">5</span> <span class="co"># Length of each interval</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>max_s <span class="op">=</span> <span class="dv">20</span> <span class="co"># Maximum service time</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.20</span> <span class="co"># Probability of a scheduled patient not showing up</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># Weight for the waiting time in objective function</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>v_star <span class="op">=</span> get_v_star(T)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"v_star: </span><span class="ch">\n</span><span class="st">"</span>, v_star)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">5</span>  <span class="co"># First 5 highest values in ascending order, rest in descending order</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> generate_weighted_list(max_s, l, i)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sum:"</span>, np.<span class="bu">sum</span>(s[<span class="dv">1</span>:]))  <span class="co"># This should be 1</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Weighted service time:"</span>, np.dot(np.arange(<span class="bu">len</span>(s)), s))  <span class="co"># This should be close to l</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>x_star <span class="op">=</span> bailey_welch_schedule(T, d, N, s)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Initial schedule: </span><span class="sc">{</span>x_star<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>convolutions <span class="op">=</span> compute_convolutions(s, N, q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>v_star: 
 [[-1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1]
 [ 1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
 [ 0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
 [ 0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1]]
[0.         0.00517998 0.00944733 0.03786456 0.0764604  0.17264825
 0.18839945 0.07116857 0.06591476 0.06538864 0.06223043 0.05585467
 0.04822407 0.02869053 0.02697275 0.02318003 0.02306176 0.01822983
 0.01362488 0.006385   0.00107412]
Sum: 1.0000000000164428
Weighted service time: 8.031774300409111
Initial schedule: [2, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 9]</code></pre>
</div>
</div>
<div id="6f405be2" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Optuna Configuration Variables ---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>x_star <span class="op">=</span> np.array(x_star)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>duration_threshold <span class="op">=</span> d <span class="co"># Use 'd' from initialization</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> w             <span class="co"># Use 'w' from initialization</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>conv_dict <span class="op">=</span> convolutions <span class="co"># Use 'convolutions' from initialization</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>num_u_variables <span class="op">=</span> v_star.shape[<span class="dv">0</span>]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Optuna Objective Factory Function</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_objective(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    initial_x_star: np.ndarray,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    modification_v_star: np.ndarray,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    objective_weight: <span class="bu">float</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    slot_duration: <span class="bu">int</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    conv_dict: Dict[<span class="bu">int</span>, np.ndarray]</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Callable[[optuna.trial.Trial], <span class="bu">float</span>]:</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Creates the objective function for Optuna, capturing problem parameters. """</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    internal_num_u <span class="op">=</span> modification_v_star.shape[<span class="dv">0</span>]</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> objective(trial: optuna.trial.Trial) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" The function Optuna minimizes. """</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Suggest u</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        U <span class="op">=</span> np.array([trial.suggest_int(<span class="ss">f"u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(internal_num_u)])</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>        u_column <span class="op">=</span> U.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Calculate r_u</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        r_u <span class="op">=</span> modification_v_star <span class="op">*</span> u_column</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Sum r_u columns</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        r_u_col_sum <span class="op">=</span> np.<span class="bu">sum</span>(r_u, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Calculate neighbor</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        neighbor_schedule <span class="op">=</span> initial_x_star <span class="op">+</span> r_u_col_sum</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5. Constraint Check</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.<span class="bu">any</span>(neighbor_schedule <span class="op">&lt;</span> <span class="dv">0</span>):</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>            message <span class="op">=</span> <span class="ss">f"Constraint violation: Resulting schedule &lt; 0: </span><span class="sc">{</span>neighbor_schedule<span class="sc">}</span><span class="ss"> (u=</span><span class="sc">{</span>U<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> optuna.exceptions.TrialPruned(message)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 6. Evaluate</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>            ewt, esp <span class="op">=</span> calculate_objective_serv_time_lookup(</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>                schedule<span class="op">=</span>neighbor_schedule,</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>                d<span class="op">=</span>slot_duration,</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>                convolutions<span class="op">=</span>conv_dict</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Optional tracking</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># trial.set_user_attr("EWT", ewt)</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>            <span class="co"># trial.set_user_attr("ESP", esp)</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Error during evaluation for schedule </span><span class="sc">{</span>neighbor_schedule<span class="sc">}</span><span class="ss"> (u=</span><span class="sc">{</span>U<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> optuna.exceptions.TrialPruned(<span class="ss">f"Evaluation failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 7. Calculate final objective</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>        objective_value <span class="op">=</span> objective_weight <span class="op">*</span> ewt <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> objective_weight) <span class="op">*</span> esp</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> objective_value</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> objective <span class="co"># Return the nested function</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Iterative Optimization Loop ---</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>max_iterations <span class="op">=</span> <span class="dv">10</span>     <span class="co"># Safety limit for iterations</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>tolerance <span class="op">=</span> <span class="fl">1e-8</span>        <span class="co"># Minimum improvement to continue</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>n_trials_per_iteration <span class="op">=</span> <span class="dv">99</span> <span class="co"># Number of *new* trials per Optuna run</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>iteration <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>improvement_found <span class="op">=</span> <span class="va">True</span> <span class="co"># Start the loop</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>current_x_star <span class="op">=</span> x_star.copy() <span class="co"># Start with the BW schedule</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>current_best_value <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>) <span class="co"># Initialize high, will be set by initial eval</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> [] <span class="co"># Optional: Store (iteration, value, schedule)</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Initial Evaluation (Get value for the starting x_star) ---</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Evaluating Initial Schedule ---"</span>)</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>    initial_study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>, study_name<span class="op">=</span><span class="st">"Initial_Eval"</span>)</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the factory to create the objective for the initial schedule</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>    initial_objective_func <span class="op">=</span> create_objective(</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>        initial_x_star<span class="op">=</span>current_x_star,      <span class="co"># Use the initial BW schedule</span></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>        modification_v_star<span class="op">=</span>v_star,</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>        objective_weight<span class="op">=</span>weight,</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>        slot_duration<span class="op">=</span>duration_threshold,</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>        conv_dict<span class="op">=</span>conv_dict</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enqueue the trial representing the initial schedule itself (U=0)</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>    initial_params <span class="op">=</span> {<span class="ss">f"u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>: <span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_u_variables)}</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>    initial_study.enqueue_trial(initial_params)</span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run only the single enqueued trial</span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>    initial_study.optimize(initial_objective_func, n_trials<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> initial_study.best_trial <span class="kw">and</span> initial_study.best_trial.state <span class="op">==</span> optuna.trial.TrialState.COMPLETE:</span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>         current_best_value <span class="op">=</span> initial_study.best_trial.value</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="ss">f"Initial Objective Value: </span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Store initial state in history</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>         history.append((iteration, current_best_value, current_x_star.copy()))</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="st">"Error: Could not evaluate initial schedule successfully."</span>)</span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>         <span class="bu">print</span>(<span class="ss">f"  Initial trial state: </span><span class="sc">{</span>initial_study<span class="sc">.</span>trials[<span class="dv">0</span>]<span class="sc">.</span>state <span class="cf">if</span> initial_study<span class="sc">.</span>trials <span class="cf">else</span> <span class="st">'N/A'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a>         improvement_found <span class="op">=</span> <span class="va">False</span> <span class="co"># Stop if initial eval fails</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a>     <span class="bu">print</span>(<span class="ss">f"An unexpected error occurred during initial evaluation: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>     improvement_found <span class="op">=</span> <span class="va">False</span> <span class="co"># Stop</span></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Iterative Optimization Loop ---</span></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> improvement_found <span class="kw">and</span> iteration <span class="op">&lt;</span> max_iterations:</span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>    iteration <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Optimization Iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss"> ---"</span>)</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Starting with schedule: </span><span class="sc">{</span>current_x_star<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Current best value to beat: </span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a>    improvement_found_this_iter <span class="op">=</span> <span class="va">False</span> <span class="co"># Reset flag for this iteration</span></span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Create new study and objective using the current best schedule</span></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>    study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>, study_name<span class="op">=</span><span class="ss">f"Sched_Opt_Iter_</span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>    objective_func <span class="op">=</span> create_objective(</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>        initial_x_star<span class="op">=</span>current_x_star, <span class="co"># Use current best as starting point</span></span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>        modification_v_star<span class="op">=</span>v_star,</span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>        objective_weight<span class="op">=</span>weight,</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>        slot_duration<span class="op">=</span>duration_threshold,</span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>        conv_dict<span class="op">=</span>conv_dict</span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Enqueue trial for the current schedule (U=0) to ensure it's evaluated</span></span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a>    params_to_enqueue <span class="op">=</span> {<span class="ss">f"u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>: <span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_u_variables)}</span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a>    study.enqueue_trial(params_to_enqueue)</span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Enqueued current schedule evaluation (Trial 0 for this iteration)."</span>)</span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Run Optuna optimization for this iteration</span></span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Running Optuna search (</span><span class="sc">{</span>n_trials_per_iteration<span class="sc">}</span><span class="ss"> new trials)..."</span>)</span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a>    start_time_iter <span class="op">=</span> time.time()</span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a>        <span class="co"># n_trials is the number of NEW trials after the enqueued one</span></span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>        study.optimize(objective_func, n_trials<span class="op">=</span>n_trials_per_iteration)</span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error during Optuna run in iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Consider whether to break or try to continue depending on error</span></span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span> <span class="co"># Stop loop on error</span></span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">finally</span>:</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>        end_time_iter <span class="op">=</span> time.time()</span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss"> Optuna run finished in </span><span class="sc">{</span>end_time_iter <span class="op">-</span> start_time_iter<span class="sc">:.2f}</span><span class="ss"> seconds."</span>)</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a>        n_trials_per_iteration <span class="op">+=</span> <span class="dv">50</span> <span class="co"># Increment for next iteration</span></span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Process results of this iteration</span></span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>    completed_trials <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> study.trials <span class="cf">if</span> t.state <span class="op">==</span> optuna.trial.TrialState.COMPLETE]</span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss"> results: </span><span class="sc">{</span><span class="bu">len</span>(completed_trials)<span class="sc">}</span><span class="ss"> completed trials out of </span><span class="sc">{</span><span class="bu">len</span>(study.trials)<span class="sc">}</span><span class="ss"> total."</span>)</span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> completed_trials:</span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a>        best_trial_iter <span class="op">=</span> study.best_trial <span class="co"># Best among completed trials in *this* study</span></span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a>        best_value_iter <span class="op">=</span> best_trial_iter.value</span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Best value found in iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>best_value_iter<span class="sc">:.6f}</span><span class="ss"> (Trial #</span><span class="sc">{</span>best_trial_iter<span class="sc">.</span>number<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5. Check for improvement compared to the start of the iteration</span></span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> best_value_iter <span class="op">&lt;</span> current_best_value <span class="op">-</span> tolerance:</span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check if the best trial is actually different from the enqueued one</span></span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> best_trial_iter.number <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">or</span> <span class="bu">len</span>(study.trials) <span class="op">==</span> <span class="dv">1</span>: <span class="co"># Improved or only initial trial ran/completed</span></span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a>                 <span class="bu">print</span>(<span class="ss">f"  Improvement found! (</span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss"> -&gt; </span><span class="sc">{</span>best_value_iter<span class="sc">:.6f}</span><span class="ss">)"</span>)</span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a>                 improvement_found_this_iter <span class="op">=</span> <span class="va">True</span></span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># Update the overall best value</span></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a>                 current_best_value <span class="op">=</span> best_value_iter</span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># Calculate the schedule that yielded this improvement</span></span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a>                 best_params_u <span class="op">=</span> best_trial_iter.params</span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a>                 best_u_list <span class="op">=</span> [best_params_u.get(<span class="ss">f'u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>, <span class="dv">0</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_u_variables)]</span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a>                 best_u_np <span class="op">=</span> np.array(best_u_list)</span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a>                 best_u_column <span class="op">=</span> best_u_np.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a>                 best_r_u <span class="op">=</span> v_star <span class="op">*</span> best_u_column</span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a>                 best_r_u_col_sum <span class="op">=</span> np.<span class="bu">sum</span>(best_r_u, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># !!! Update current_x_star for the NEXT iteration !!!</span></span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># Apply the modification found to the schedule that started this iteration</span></span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a>                 current_x_star <span class="op">=</span> current_x_star <span class="op">+</span> best_r_u_col_sum</span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a>                 <span class="bu">print</span>(<span class="ss">f"  Updated current_x_star for next iteration: </span><span class="sc">{</span>current_x_star<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># Optional: Store history</span></span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a>                 history.append((iteration, current_best_value, current_x_star.copy()))</span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># Best trial was the enqueued one (value might be slightly different due to float precision but not &lt; tolerance)</span></span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a>                 <span class="bu">print</span>(<span class="ss">f"  Best trial was the enqueued starting point. No improvement among new trials."</span>)</span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a>                 improvement_found_this_iter <span class="op">=</span> <span class="va">False</span></span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a>            <span class="co"># No significant improvement found</span></span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  No significant improvement found over current best value (</span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss">)."</span>)</span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a>            improvement_found_this_iter <span class="op">=</span> <span class="va">False</span></span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true" tabindex="-1"></a>        <span class="co"># No trials completed successfully in this iteration</span></span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"  No trials completed successfully in this iteration. Stopping."</span>)</span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a>        improvement_found_this_iter <span class="op">=</span> <span class="va">False</span></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update master loop flag</span></span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a>    improvement_found <span class="op">=</span> improvement_found_this_iter</span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a><span class="co"># --- End of Loop ---</span></span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Iterative Optimization Finished ---"</span>)</span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> iteration <span class="op">&gt;=</span> max_iterations:</span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Stopping: Reached maximum iteration limit (</span><span class="sc">{</span>max_iterations<span class="sc">}</span><span class="ss">)."</span>)</span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="kw">not</span> improvement_found:</span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a>     <span class="bu">print</span>(<span class="ss">f"Stopping: No further improvement found in iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true" tabindex="-1"></a>     <span class="bu">print</span>(<span class="st">"Stopping: Loop finished for other reasons."</span>)</span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Final Results ---</span></span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Final Optimal Result ---"</span>)</span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> history: <span class="co"># Check if any results were recorded</span></span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true" tabindex="-1"></a>    final_iter, final_value, final_schedule <span class="op">=</span> history[<span class="op">-</span><span class="dv">1</span>] <span class="co"># Get last recorded state</span></span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Found after iteration: </span><span class="sc">{</span>final_iter<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Final Objective Value: </span><span class="sc">{</span>final_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb15-209"><a href="#cb15-209" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Final Optimal Schedule: </span><span class="sc">{</span>final_schedule<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-210"><a href="#cb15-210" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sum of Final Schedule: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(final_schedule)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-211"><a href="#cb15-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-212"><a href="#cb15-212" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compare with the very initial schedule</span></span>
<span id="cb15-213"><a href="#cb15-213" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Comparison with Initial Schedule:"</span>)</span>
<span id="cb15-214"><a href="#cb15-214" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Initial Schedule (Iter 0): </span><span class="sc">{</span>history[<span class="dv">0</span>][<span class="dv">2</span>]<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-215"><a href="#cb15-215" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Initial Objective Value:   </span><span class="sc">{</span>history[<span class="dv">0</span>][<span class="dv">1</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true" tabindex="-1"></a>     <span class="bu">print</span>(<span class="st">"No results found (Initial evaluation might have failed or no iterations ran)."</span>)</span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Print full history</span></span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true" tabindex="-1"></a><span class="co"># print("\n--- Optimization History ---")</span></span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a><span class="co"># for iter_num, value, sched in history:</span></span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a><span class="co">#    print(f"Iter {iter_num}: Value={value:.6f}, Schedule={sched.astype(int)}")</span></span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> time.time()</span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total time taken for optimization: </span><span class="sc">{</span>end <span class="op">-</span> start<span class="sc">:.2f}</span><span class="ss"> seconds."</span>)</span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- End of Script ---"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-04-30 20:53:26,801] A new study created in memory with name: Initial_Eval
[I 2025-04-30 20:53:26,805] Trial 0 finished with value: 86.28550068647573 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:26,807] A new study created in memory with name: Sched_Opt_Iter_1
[I 2025-04-30 20:53:26,812] Trial 0 finished with value: 86.28550068647573 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:26,816] Trial 1 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1  0  1  1 -1  2 -1  1  1  1  0  1  1  0  1  1  0  1  9] (u=[1 1 1 1 1 1 0 1 0 0 0 1 0 0 1 0 1 1 0 1])
[I 2025-04-30 20:53:26,821] Trial 2 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  1  1 -1  2  0  0  2  0  0  1  1  0  1  0  1  1  8] (u=[0 1 0 1 1 1 0 1 1 0 1 1 0 0 1 0 1 0 0 1])
[I 2025-04-30 20:53:26,825] Trial 3 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0  0  1  1  1  0  0  1  2  0  1 -1  1  1  1  8] (u=[0 1 0 0 1 0 0 0 1 1 0 0 0 1 1 1 0 0 0 1])
[I 2025-04-30 20:53:26,831] Trial 4 finished with value: 94.05532618435089 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 1, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 1, 'u_14': 1, 'u_15': 1, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:26,835] Trial 5 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1  0  2  0  1  1  0  0  1  0  1  2 -1  2 -1  2  1  0  8] (u=[0 0 0 0 1 0 1 1 1 0 0 0 0 1 0 1 0 1 1 1])
[I 2025-04-30 20:53:26,839] Trial 6 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1  0  0  2  0  1  0  1  0  0  1  1  0  1  0  2  1 -1  9] (u=[0 1 1 1 0 1 1 1 1 1 0 0 0 0 0 0 0 1 1 0])
[I 2025-04-30 20:53:26,844] Trial 7 pruned. Constraint violation: Resulting schedule &lt; 0: [ 1  1  0  1  1  1  1 -1  2  1  0  0  2  0  1  0  0  2 -1 10] (u=[1 0 0 0 0 0 1 1 0 1 1 1 0 1 1 1 1 0 1 0])
[I 2025-04-30 20:53:26,849] Trial 8 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1  1  1  0  1  1 -1  1  1  0  2  1 -1  2  0  0  1  0  9] (u=[0 0 0 1 1 0 1 1 0 0 0 0 1 1 0 1 1 0 0 0])
[I 2025-04-30 20:53:26,853] Trial 9 pruned. Constraint violation: Resulting schedule &lt; 0: [ 1  1  1  0  1  1  0  0  1  1  1  0  2  0  1  0  0  2 -1 10] (u=[1 0 0 1 0 0 1 0 0 0 0 1 0 1 1 1 1 0 1 0])
[I 2025-04-30 20:53:26,951] Trial 10 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  2 -1  1  2 -1  1  0  1  2 -1  2  0  0  1  0  2  0  0  9] (u=[0 0 1 0 0 1 0 0 0 0 1 0 1 0 0 0 0 1 0 0])
[I 2025-04-30 20:53:27,046] Trial 11 finished with value: 94.40060390827409 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:27,126] Trial 12 pruned. Constraint violation: Resulting schedule &lt; 0: [ 1  1  1  0  1  0  1  0  2  0  0  2  1 -1  2  0  0  1  0 10] (u=[1 0 0 1 0 0 0 0 0 1 0 0 1 1 0 1 1 0 0 0])
[I 2025-04-30 20:53:27,207] Trial 13 finished with value: 94.44497565287224 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 0, 'u_14': 1, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:27,283] Trial 14 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  2  0  0  1  0  1  0  1  2 -1  2  1  0  1  0  0  1  0  9] (u=[0 0 1 1 0 0 0 0 0 0 1 0 1 1 1 1 1 0 0 0])
[I 2025-04-30 20:53:27,363] Trial 15 finished with value: 94.40060390827409 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:27,444] Trial 16 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1  0  1  1  0  1  0  2  0  0  1  2 -1  2  0  0  1  0  9] (u=[0 0 0 0 0 0 0 0 0 1 0 0 0 1 0 1 1 0 0 0])
[I 2025-04-30 20:53:27,526] Trial 17 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1  0  0  2 -1  1  1  0  2  0  1  0  1  0  0  2  1  0  9] (u=[1 1 1 1 0 1 0 0 1 0 1 1 1 0 1 0 0 1 1 1])
[I 2025-04-30 20:53:27,609] Trial 18 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1  1  0  1  0  1  0  1  1  0  1  2 -1  2 -1  1  1  0  9] (u=[0 0 0 1 0 0 0 0 0 0 0 0 0 1 0 1 0 0 0 0])
[I 2025-04-30 20:53:27,693] Trial 19 finished with value: 93.65503448975096 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 0, 'u_14': 1, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:27,777] Trial 20 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  1  0  0  1  0  2  0  1  0  1  0  0  2  1  0  8] (u=[0 1 1 0 1 1 1 0 1 0 1 1 1 0 1 0 0 1 1 1])
[I 2025-04-30 20:53:27,867] Trial 21 finished with value: 93.65503448975096 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 0, 'u_14': 1, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:27,956] Trial 22 finished with value: 93.65503448975096 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 0, 'u_14': 1, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,042] Trial 23 finished with value: 93.65503448975096 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 0, 'u_14': 1, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,129] Trial 24 finished with value: 93.65503448975096 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 0, 'u_14': 1, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,215] Trial 25 finished with value: 93.65503448975096 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 1, 'u_13': 0, 'u_14': 1, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,302] Trial 26 finished with value: 93.48465551841437 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,392] Trial 27 finished with value: 93.48465551841437 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 1, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,481] Trial 28 finished with value: 86.28550068647573 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,569] Trial 29 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  1 -1  2 -1  1  1  1  0  1  0  1  0  2  0  1  8] (u=[0 1 1 0 1 1 0 1 0 0 0 1 0 0 0 0 0 1 0 1])
[I 2025-04-30 20:53:28,656] Trial 30 finished with value: 86.28550068647573 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,745] Trial 31 finished with value: 86.28550068647573 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,839] Trial 32 finished with value: 86.28550068647573 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:28,931] Trial 33 finished with value: 86.28550068647573 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:29,024] Trial 34 finished with value: 86.28550068647573 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 86.28550068647573.
[I 2025-04-30 20:53:29,116] Trial 35 finished with value: 85.36578602312377 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,199] Trial 36 finished with value: 85.77552615714848 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,285] Trial 37 finished with value: 85.77552615714848 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,373] Trial 38 finished with value: 86.5827313925972 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 1, 'u_6': 1, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,458] Trial 39 finished with value: 85.76915227734645 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,544] Trial 40 finished with value: 85.76915227734645 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,630] Trial 41 finished with value: 85.76915227734645 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,715] Trial 42 finished with value: 85.76915227734645 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,806] Trial 43 finished with value: 85.76915227734645 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,892] Trial 44 finished with value: 85.76915227734645 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:29,980] Trial 45 finished with value: 85.76915227734645 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,066] Trial 46 finished with value: 85.76915227734645 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,149] Trial 47 finished with value: 85.8058756555545 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 0, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,238] Trial 48 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,325] Trial 49 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,405] Trial 50 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  0  0  2  0  0  1  0  1  1  0  1  0  2  1  0  8] (u=[0 1 1 0 1 0 0 1 1 0 0 0 0 0 0 0 0 1 1 1])
[I 2025-04-30 20:53:30,493] Trial 51 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,576] Trial 52 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,655] Trial 53 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,760] Trial 54 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,843] Trial 55 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:30,921] Trial 56 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  1  0  0  2  0  0  2 -1  1  1  0  1  0  2  1  0  8] (u=[0 1 0 1 1 0 0 1 1 0 1 0 0 0 0 0 0 1 1 1])
[I 2025-04-30 20:53:31,005] Trial 57 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0  0  2  0  0  1  0  1  2 -1  2 -1  2  1  0  8] (u=[0 1 0 0 1 0 0 1 1 0 0 0 0 1 0 1 0 1 1 1])
[I 2025-04-30 20:53:31,096] Trial 58 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:31,183] Trial 59 finished with value: 85.7109759770961 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:31,274] Trial 60 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  1 -1  2  0  0  1  1  0  1  0  1  0  2  1  0  8] (u=[0 1 0 0 1 1 0 1 1 0 0 1 0 0 0 0 0 1 1 1])
[I 2025-04-30 20:53:31,363] Trial 61 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:31,454] Trial 62 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:31,543] Trial 63 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:31,654] Trial 64 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:31,747] Trial 65 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:31,839] Trial 66 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:31,931] Trial 67 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,022] Trial 68 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,112] Trial 69 finished with value: 85.78640498562031 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 1, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,203] Trial 70 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0  0  2  0  0  1  0  1  2 -1  1  0  2  1  0  8] (u=[0 1 0 0 1 0 0 1 1 0 0 0 0 1 0 0 0 1 1 1])
[I 2025-04-30 20:53:32,304] Trial 71 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,392] Trial 72 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,474] Trial 73 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,556] Trial 74 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,639] Trial 75 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,719] Trial 76 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,803] Trial 77 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  0  0  2  0  0  1  0  1  1  0  2 -1  2  1  0  8] (u=[0 1 1 0 1 0 0 1 1 0 0 0 0 0 0 1 0 1 1 1])
[I 2025-04-30 20:53:32,891] Trial 78 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:32,977] Trial 79 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0  0  2  0  0  2 -1  1  1  0  1  0  2  1  0  8] (u=[0 1 0 0 1 0 0 1 1 0 1 0 0 0 0 0 0 1 1 1])
[I 2025-04-30 20:53:33,070] Trial 80 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:33,155] Trial 81 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:33,241] Trial 82 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:33,322] Trial 83 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:33,407] Trial 84 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:33,491] Trial 85 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:33,576] Trial 86 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:33,660] Trial 87 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:33,741] Trial 88 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:33,824] Trial 89 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  1 -1  2  0  0  1  1  0  1  0  1  0  2  1  0  8] (u=[0 1 0 0 1 1 0 1 1 0 0 1 0 0 0 0 0 1 1 1])
[I 2025-04-30 20:53:33,918] Trial 90 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,009] Trial 91 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,100] Trial 92 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,184] Trial 93 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,263] Trial 94 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,342] Trial 95 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,422] Trial 96 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,507] Trial 97 finished with value: 85.7109759770961 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 1, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,595] Trial 98 finished with value: 85.67942492418065 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 0, 'u_3': 0, 'u_4': 1, 'u_5': 0, 'u_6': 0, 'u_7': 1, 'u_8': 1, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 1, 'u_18': 1, 'u_19': 1}. Best is trial 35 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,635] A new study created in memory with name: Sched_Opt_Iter_2
[I 2025-04-30 20:53:34,639] Trial 0 finished with value: 85.36578602312377 and parameters: {'u_0': 0, 'u_1': 0, 'u_2': 0, 'u_3': 0, 'u_4': 0, 'u_5': 0, 'u_6': 0, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 0, 'u_11': 0, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 0}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:34,644] Trial 1 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  0  2  0  1  0  1  0  1  0  0  2  1  0  9] (u=[1 1 0 1 0 1 1 0 1 1 1 1 1 0 1 0 0 1 1 0])
[I 2025-04-30 20:53:34,648] Trial 2 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  1  1 -1  1  1  1  1  0  0  0  2  1  1  8] (u=[1 1 0 1 0 1 1 1 1 0 0 1 1 1 1 0 0 1 1 1])
[I 2025-04-30 20:53:34,652] Trial 3 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0 -1  2  1  0  1 -1  1  1  0  2 -1  1  1  2  8] (u=[1 1 1 1 1 1 0 1 1 1 1 0 0 0 0 1 0 0 0 1])
[I 2025-04-30 20:53:34,657] Trial 4 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  2  0 -1  2  1  0  1  0  0  2 -1  2  0  1  0  2  8] (u=[1 0 0 1 1 1 0 1 1 1 1 1 0 1 0 1 1 1 0 1])
[I 2025-04-30 20:53:34,661] Trial 5 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  0  2  1  0  1  0  1  1  0  0  1  0  1  1  0  2  1  8] (u=[1 1 0 0 0 1 1 1 0 1 1 1 0 0 0 0 1 0 1 1])
[I 2025-04-30 20:53:34,664] Trial 6 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  2 -1  1  1  0  1  0  1  0  2 -1  1  1  0  2  1  7] (u=[0 0 0 1 1 0 1 1 0 1 0 1 0 1 0 0 1 0 1 1])
[I 2025-04-30 20:53:34,668] Trial 7 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  0  1  0  1  1  0  1  0  1  0  2 -1  2  0  2  7] (u=[0 0 1 0 0 0 1 0 0 1 0 1 0 0 0 1 0 1 0 1])
[I 2025-04-30 20:53:34,671] Trial 8 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  3 -1  0  2  1  0  0  0  1  2 -1  1  0  2  1  1  7] (u=[0 1 0 0 1 0 0 1 1 1 0 0 0 1 0 0 0 1 1 1])
[I 2025-04-30 20:53:34,676] Trial 9 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  2  0  1  0  1  1  1 -1  2  0  1  1 -1  1  2  1  7] (u=[0 1 0 0 0 0 1 0 0 1 1 0 1 0 1 1 0 0 1 1])
[I 2025-04-30 20:53:34,746] Trial 10 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  0  0  1  1  0  1  0  2  0  1  0  1  0  1  1  8] (u=[0 0 1 0 0 0 0 0 0 0 0 0 1 0 1 0 1 0 0 0])
[I 2025-04-30 20:53:34,817] Trial 11 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  1  1 -1  1  2 -1  2 -1  2  0  1  0  0  2  0  1  9] (u=[1 0 0 1 0 1 0 0 1 0 1 0 1 0 1 0 0 1 0 0])
[I 2025-04-30 20:53:34,886] Trial 12 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  1  1  0  0  2 -1  1  1  1  0  1  0  0  1  2  0  9] (u=[1 0 0 1 0 1 1 0 1 0 0 1 1 0 1 0 0 0 1 0])
[I 2025-04-30 20:53:34,954] Trial 13 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  2  0  0  1  1  0  2 -1  2  0  1  0  0  2  0  1  8] (u=[0 1 0 0 0 0 0 0 0 0 1 0 1 0 1 0 0 1 0 0])
[I 2025-04-30 20:53:35,031] Trial 14 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4  0 -1  2  0  1  0  1  0  1  1  0  1  0  1  0  1  2  0  8] (u=[0 1 1 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 1 0])
[I 2025-04-30 20:53:35,111] Trial 15 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  1  1 -1  1  2 -1  2 -1  2  0  1  0  0  2  0  1  9] (u=[1 0 0 1 0 1 0 0 1 0 1 0 1 0 1 0 0 1 0 0])
[I 2025-04-30 20:53:35,189] Trial 16 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  1  1  0  1  0  1  1  1 -1  1  1  0  1  0  2  1  0  8] (u=[0 1 0 1 0 0 1 0 0 1 1 0 0 0 0 0 0 1 1 0])
[I 2025-04-30 20:53:35,264] Trial 17 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1 -1  3  0 -1  1  2 -1  1  1  1  1  0  1  0  0  1  1  9] (u=[1 0 1 0 1 1 0 0 1 0 0 1 1 1 1 1 1 0 0 0])
[I 2025-04-30 20:53:35,336] Trial 18 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  1  1  1  0  0  1  0  1  1  0  1  0  1  0  1  1  1  8] (u=[0 1 0 1 0 1 1 0 0 0 0 1 0 0 0 0 0 0 0 0])
[I 2025-04-30 20:53:35,418] Trial 19 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  0  2  0  0  1  2  0  1 -1  2  0  1  0  0  2  1  0  9] (u=[1 0 0 0 0 0 0 0 1 1 1 0 1 0 1 0 0 1 1 0])
[I 2025-04-30 20:53:35,501] Trial 20 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4  0  0  2 -1  1  0  2 -1  1  1  1  1  0  1  0  1  0  1  8] (u=[0 1 1 1 1 0 1 0 1 0 0 1 1 1 1 1 1 1 0 0])
[I 2025-04-30 20:53:35,591] Trial 21 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  1  1 -1  1  1  1  1  0  0  0  2  1  1  8] (u=[1 1 0 1 0 1 1 1 1 0 0 1 1 1 1 0 0 1 1 1])
[I 2025-04-30 20:53:35,677] Trial 22 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  1  1 -1  1  1  1  1  0  0  0  2  1  0  9] (u=[1 1 0 1 0 1 1 1 1 0 0 1 1 1 1 0 0 1 1 0])
[I 2025-04-30 20:53:35,764] Trial 23 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  1  1 -1  1  1  1  1  0  0  0  2  1  0  9] (u=[1 1 0 1 0 1 1 1 1 0 0 1 1 1 1 0 0 1 1 0])
[I 2025-04-30 20:53:35,847] Trial 24 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  1  1 -1  1  1  1  1  0  0  0  2  1  1  8] (u=[1 1 0 1 0 1 1 1 1 0 0 1 1 1 1 0 0 1 1 1])
[I 2025-04-30 20:53:35,929] Trial 25 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  0  2 -1  1  1  1  0  1  0  0  2  1  0  9] (u=[1 1 0 1 0 1 1 0 1 0 0 1 1 0 1 0 0 1 1 0])
[I 2025-04-30 20:53:36,014] Trial 26 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  0  2  1 -1  2  0  1  1 -1  1  2 -1  1  0  1  2  1  8] (u=[1 0 0 0 0 1 0 1 0 1 1 0 0 1 0 0 0 0 1 1])
[I 2025-04-30 20:53:36,100] Trial 27 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  0  2 -1  1  1  1  0  1  0  0  2  1  0  9] (u=[1 1 0 1 0 1 1 0 1 0 0 1 1 0 1 0 0 1 1 0])
[I 2025-04-30 20:53:36,189] Trial 28 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0  0  2  0  1  1 -1  1  2 -1  1  0  1  1  2  7] (u=[0 0 0 0 0 0 0 1 0 1 1 0 0 1 0 0 0 0 0 1])
[I 2025-04-30 20:53:36,277] Trial 29 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0  0  0  2 -1  1  1  1  0  1  1 -1  2  1  0  9] (u=[1 1 1 1 1 1 1 0 1 0 0 1 1 0 1 1 0 1 1 0])
[I 2025-04-30 20:53:36,367] Trial 30 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1 -1  2  1  0  1 -1  1  1  0  1  0  1  1  2  8] (u=[1 1 0 1 0 1 0 1 1 1 1 0 0 0 0 0 0 0 0 1])
[I 2025-04-30 20:53:36,461] Trial 31 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0 -1  2  1  0  1 -1  1  1  0  2 -1  1  1  2  8] (u=[1 1 1 1 1 1 0 1 1 1 1 0 0 0 0 1 0 0 0 1])
[I 2025-04-30 20:53:36,546] Trial 32 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0 -1  2  1  0  1 -1  1  1  0  2 -1  1  1  2  8] (u=[1 1 1 1 1 1 0 1 1 1 1 0 0 0 0 1 0 0 0 1])
[I 2025-04-30 20:53:36,641] Trial 33 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0 -1  2  1  0  1 -1  1  1  0  2  0  0  1  2  8] (u=[1 1 1 1 1 1 0 1 1 1 1 0 0 0 0 1 1 0 0 1])
[I 2025-04-30 20:53:36,733] Trial 34 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0 -1  2  1  0  1  0  0  1  0  2 -1  1  1  2  8] (u=[1 1 1 1 1 1 0 1 1 1 1 1 0 0 0 1 0 0 0 1])
[I 2025-04-30 20:53:36,825] Trial 35 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  2  0 -1  2  1  0  1 -1  1  1  0  2  0  0  1  2  8] (u=[1 1 0 1 1 1 0 1 1 1 1 0 0 0 0 1 1 0 0 1])
[I 2025-04-30 20:53:36,907] Trial 36 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  0  3  0  0  1  0  1  1  0  0  2 -1  1  0  2  1  1  8] (u=[1 0 0 0 1 1 1 1 0 1 1 1 0 1 0 0 0 1 1 1])
[I 2025-04-30 20:53:36,987] Trial 37 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4  0  0  1  0  0  2  1  0  0  0  1  1  0  2 -1  1  1  2  7] (u=[0 1 1 1 0 0 0 1 1 1 0 0 0 0 0 1 0 0 0 1])
[I 2025-04-30 20:53:37,066] Trial 38 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  0  2  1  0  0  1  1  1 -1  1  1  0  1  0  1  2  1  8] (u=[1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 0 0 1 1])
[I 2025-04-30 20:53:37,148] Trial 39 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  1  2 -1  0  2  1  0  0  1  1  1  0  0  1  1  0  2  7] (u=[0 1 0 1 1 0 0 1 1 1 0 1 1 1 1 0 1 1 0 1])
[I 2025-04-30 20:53:37,228] Trial 40 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1 -1  2  1  0  0  1  0  2 -1  1  1  0  2 -1  1  2  0  9] (u=[1 0 1 0 0 1 1 0 0 0 1 0 0 0 0 1 0 0 1 0])
[I 2025-04-30 20:53:37,308] Trial 41 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  2  0 -1  2  1  0  1  0  0  2 -1  2  0  1  0  2  8] (u=[1 0 0 1 1 1 0 1 1 1 1 1 0 1 0 1 1 1 0 1])
[I 2025-04-30 20:53:37,391] Trial 42 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  2  0 -1  2  1  0  1  0  0  2 -1  2  0  1  0  2  8] (u=[1 0 0 1 1 1 0 1 1 1 1 1 0 1 0 1 1 1 0 1])
[I 2025-04-30 20:53:37,475] Trial 43 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  2  0 -1  2  1  0  1  0  0  2 -1  2  0  1  0  2  8] (u=[1 0 0 1 1 1 0 1 1 1 1 1 0 1 0 1 1 1 0 1])
[I 2025-04-30 20:53:37,559] Trial 44 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  2 -1  0  2  1  0  1  0  0  2 -1  2  0  1  0  2  7] (u=[0 0 0 1 1 0 0 1 1 1 1 1 0 1 0 1 1 1 0 1])
[I 2025-04-30 20:53:37,645] Trial 45 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  1  1 -1  1  2  0  1  0  0  1  0  1  0  2  0  1  9] (u=[1 0 0 1 0 1 0 0 1 1 1 1 0 0 0 0 0 1 0 0])
[I 2025-04-30 20:53:37,730] Trial 46 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  1  1 -1  1  1  0  1  1  1  0  1  0  0  2  0  2  8] (u=[1 0 0 1 0 1 0 0 0 0 0 1 1 0 1 0 0 1 0 1])
[I 2025-04-30 20:53:37,814] Trial 47 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  3 -1  1  1  1  0  1 -1  1  2 -1  2 -1  2  1  0  8] (u=[0 1 0 0 1 0 1 1 1 1 1 0 0 1 0 1 0 1 1 0])
[I 2025-04-30 20:53:37,901] Trial 48 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1 -1  1  2 -1  1  1  1  0  1  0  1  0  1  2  8] (u=[1 1 0 1 0 1 0 0 1 0 0 1 1 0 1 0 1 0 0 1])
[I 2025-04-30 20:53:37,984] Trial 49 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  1  1  0  0  1  0  2 -1  2  1  0  0  0  2  1  0  8] (u=[0 0 0 1 0 1 1 0 0 0 1 0 1 1 1 0 0 1 1 0])
[I 2025-04-30 20:53:38,074] Trial 50 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  0  3 -1  0  2  1  0  0  1  0  1  0  2 -1  1  1  1  9] (u=[1 1 0 0 1 0 0 1 1 1 0 1 0 0 0 1 0 0 0 0])
[I 2025-04-30 20:53:38,159] Trial 51 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  0  2  1  0  1  0  1  1  0  0  1  0  1  1  0  2  1  8] (u=[1 1 0 0 0 1 1 1 0 1 1 1 0 0 0 0 1 0 1 1])
[I 2025-04-30 20:53:38,242] Trial 52 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  0  2  1  0  1  0  1  1  0  0  1  0  1  1  0  2  1  8] (u=[1 1 0 0 0 1 1 1 0 1 1 1 0 0 0 0 1 0 1 1])
[I 2025-04-30 20:53:38,323] Trial 53 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  0  2  1  0  1  0  1  1  0  0  1  0  1  1  0  2  1  8] (u=[1 1 0 0 0 1 1 1 0 1 1 1 0 0 0 0 1 0 1 1])
[I 2025-04-30 20:53:38,405] Trial 54 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  0  2  1  0  1  0  1  1  0  1  0  1  0  1  0  2  1  8] (u=[1 1 0 0 0 1 1 1 0 1 1 1 1 0 1 0 1 0 1 1])
[I 2025-04-30 20:53:38,486] Trial 55 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  0  2  1  0  0  1  0  1  1  0  1  0  1  1  1  1  1  8] (u=[1 1 0 0 0 1 1 0 0 0 0 1 0 0 0 0 1 1 1 1])
[I 2025-04-30 20:53:38,568] Trial 56 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  1  1  0  1  0  1  0  1  0  0  1  2  0  9] (u=[1 1 0 1 0 1 1 1 1 1 1 1 1 0 1 0 0 0 1 0])
[I 2025-04-30 20:53:38,653] Trial 57 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  1  1  0  1  0  0  1  1  0  2 -1  1  0  2  1  1  7] (u=[0 0 0 1 0 1 1 1 0 0 0 1 0 1 0 0 0 1 1 1])
[I 2025-04-30 20:53:38,737] Trial 58 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0 -1  2  0  1  0  2  0  1 -1  2  0  1  0  0  2  0  1  9] (u=[1 1 1 0 0 0 1 0 1 1 1 0 1 0 1 0 0 1 0 0])
[I 2025-04-30 20:53:38,820] Trial 59 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1 -1  2  1 -1  1  1  0  2 -1  1  1  0  2  1  8] (u=[1 1 0 1 0 1 0 1 1 0 0 1 0 1 0 0 1 0 1 1])
[I 2025-04-30 20:53:38,907] Trial 60 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1  0  0  1  1  1 -1  2  0  1  0  0  2  0  1  9] (u=[1 1 0 1 0 1 1 0 0 1 1 0 1 0 1 0 0 1 0 0])
[I 2025-04-30 20:53:38,989] Trial 61 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  2 -1  1  1  0  1  0  1  0  2 -1  1  1  0  2  1  7] (u=[0 0 0 1 1 0 1 1 0 1 0 1 0 1 0 0 1 0 1 1])
[I 2025-04-30 20:53:39,072] Trial 62 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  2 -1  1  1  0  1  0  1  0  2 -1  1  1  0  2  1  7] (u=[0 0 0 1 1 0 1 1 0 1 0 1 0 1 0 0 1 0 1 1])
[I 2025-04-30 20:53:39,157] Trial 63 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  2 -1  1  1  0  1  0  1  0  2 -1  1  1  0  2  1  7] (u=[0 0 0 1 1 0 1 1 0 1 0 1 0 1 0 0 1 0 1 1])
[I 2025-04-30 20:53:39,241] Trial 64 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  2 -1  1  1  0  1  0  1  0  2 -1  1  1  0  2  1  7] (u=[0 0 0 1 1 0 1 1 0 1 0 1 0 1 0 0 1 0 1 1])
[I 2025-04-30 20:53:39,324] Trial 65 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  1  2 -1  1  1  1  0  0  1  0  2 -1  1  0  1  2  1  7] (u=[0 0 0 1 1 0 1 1 1 1 0 1 0 1 0 0 0 0 1 1])
[I 2025-04-30 20:53:39,408] Trial 66 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1  0  2  0 -1  2  0  0  1  1  0  1  0  1  1  0  2  1  8] (u=[1 0 1 1 1 1 0 1 0 0 0 1 0 0 0 0 1 0 1 1])
[I 2025-04-30 20:53:39,494] Trial 67 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  2  0  1  1  1  0  1 -1  1  2 -1  2 -1  1  2  1  7] (u=[0 1 0 0 0 0 1 1 1 1 1 0 0 1 0 1 0 0 1 1])
[I 2025-04-30 20:53:39,579] Trial 68 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  2  0 -1  1  2 -1  2  0  1  0  1  0  0  2  0  1  9] (u=[1 1 0 1 1 1 0 0 1 0 1 1 1 0 1 0 0 1 0 0])
[I 2025-04-30 20:53:39,663] Trial 69 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1  0  1  1  0  1  0  1  0  0  1  2 -1  2  0  0  1  2  8] (u=[1 0 1 1 0 1 1 1 0 1 0 0 0 1 0 1 1 0 0 1])
[I 2025-04-30 20:53:39,748] Trial 70 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  1  2 -1  0  2  1  0  1  0  0  1  0  1  0  2  1  1  7] (u=[0 1 0 1 1 0 0 1 1 1 1 1 0 0 0 0 0 1 1 1])
[I 2025-04-30 20:53:39,836] Trial 71 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  0  1  0  1  1  0  1  0  1  0  2 -1  2  0  2  7] (u=[0 0 1 0 0 0 1 0 0 1 0 1 0 0 0 1 0 1 0 1])
[I 2025-04-30 20:53:39,922] Trial 72 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  0  1  0  1  1  0  1  0  1  0  2 -1  2  0  2  7] (u=[0 0 1 0 0 0 1 0 0 1 0 1 0 0 0 1 0 1 0 1])
[I 2025-04-30 20:53:40,009] Trial 73 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  0  1  0  1  1  0  1  0  1  0  2 -1  2  0  2  7] (u=[0 0 1 0 0 0 1 0 0 1 0 1 0 0 0 1 0 1 0 1])
[I 2025-04-30 20:53:40,096] Trial 74 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  1 -1  2  0  1  0  1  1  0  1  0  1  0  2 -1  2  0  2  7] (u=[0 0 1 0 0 0 1 0 0 1 0 1 0 0 0 1 0 1 0 1])
[I 2025-04-30 20:53:40,190] Trial 75 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  1 -1  2  1  0  0  1  1  0  1  0  1  0  2 -1  2  0  2  8] (u=[1 0 1 0 0 1 1 0 0 1 0 1 0 0 0 1 0 1 0 1])
[I 2025-04-30 20:53:40,277] Trial 76 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0  0  1  2 -1  1  0  2  0  1  1 -1  2  0  1  8] (u=[0 0 0 0 0 0 0 0 1 0 0 0 1 0 1 1 0 1 0 0])
[I 2025-04-30 20:53:40,363] Trial 77 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3  0  0  2  0  0  1  1  0  1  0  0  2 -1  1  0  1  1  2  8] (u=[1 1 1 1 1 1 1 1 1 1 1 1 0 1 0 0 0 0 0 1])
[I 2025-04-30 20:53:40,454] Trial 78 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  1  1 -1  1  1  1  0  1  0  1  0  2  0  1  1  1  8] (u=[1 0 0 1 0 1 0 0 0 1 0 1 0 0 0 1 1 1 1 1])
[I 2025-04-30 20:53:40,540] Trial 79 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  2  0  1  1  1  0  1 -1  2  0  1  0  0  1  1  1  8] (u=[0 1 0 0 0 0 1 1 1 1 1 0 1 0 1 0 0 0 0 0])
[I 2025-04-30 20:53:40,626] Trial 80 pruned. Constraint violation: Resulting schedule &lt; 0: [ 2  0  1  2  0 -1  1  1  0  2  0  0  2 -1  2 -1  2  1  1  8] (u=[1 0 0 1 1 1 0 0 0 0 1 1 0 1 0 1 0 1 1 1])
[I 2025-04-30 20:53:40,714] Trial 81 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  3 -1  0  2  1  0  0  0  1  2 -1  1  0  2  1  1  7] (u=[0 1 0 0 1 0 0 1 1 1 0 0 0 1 0 0 0 1 1 1])
[I 2025-04-30 20:53:40,801] Trial 82 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  3 -1  0  2  1  0  0  0  1  2 -1  1  0  2  1  1  7] (u=[0 1 0 0 1 0 0 1 1 1 0 0 0 1 0 0 0 1 1 1])
[I 2025-04-30 20:53:40,888] Trial 83 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  3 -1  0  2  1  0  0  0  1  2 -1  1  0  2  1  1  7] (u=[0 1 0 0 1 0 0 1 1 1 0 0 0 1 0 0 0 1 1 1])
[I 2025-04-30 20:53:40,973] Trial 84 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  3 -1  0  2  1  0  0  0  1  2 -1  1  0  2  1  1  7] (u=[0 1 0 0 1 0 0 1 1 1 0 0 0 1 0 0 0 1 1 1])
[I 2025-04-30 20:53:41,064] Trial 85 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4 -1  0  3 -1  0  2  1  0  0  0  1  2 -1  1  0  2  1  1  7] (u=[0 1 0 0 1 0 0 1 1 1 0 0 0 1 0 0 0 1 1 1])
[I 2025-04-30 20:53:41,152] Trial 86 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  1  1  1 -1  2  1  0  0  1  0  1  0  1  1  0  1  1  9] (u=[1 1 0 1 0 1 0 1 1 1 0 1 0 0 0 0 1 0 0 0])
[I 2025-04-30 20:53:41,238] Trial 87 pruned. Constraint violation: Resulting schedule &lt; 0: [ 3 -1  0  3  0  0  1  1  0  1 -1  2  1  0  0  0  2  1  1  8] (u=[1 1 0 0 1 1 1 1 1 1 1 0 1 1 1 0 0 1 1 1])
[I 2025-04-30 20:53:41,325] Trial 88 finished with value: 87.00004162702658 and parameters: {'u_0': 0, 'u_1': 1, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 0, 'u_6': 1, 'u_7': 1, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 0, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:41,411] Trial 89 pruned. Constraint violation: Resulting schedule &lt; 0: [ 4  0  0  1  0  1  1  0  0  2  0  0  1  0  2 -1  1  1  2  7] (u=[0 1 1 1 0 0 1 1 0 0 1 1 0 0 0 1 0 0 0 1])
[I 2025-04-30 20:53:41,497] Trial 90 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:41,581] Trial 91 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:41,672] Trial 92 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:41,763] Trial 93 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:41,849] Trial 94 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:41,936] Trial 95 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,021] Trial 96 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,106] Trial 97 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,196] Trial 98 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,287] Trial 99 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,374] Trial 100 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,463] Trial 101 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,557] Trial 102 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,646] Trial 103 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,731] Trial 104 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,818] Trial 105 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:42,909] Trial 106 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:43,083] Trial 107 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:43,305] Trial 108 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:43,419] Trial 109 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:43,527] Trial 110 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:43,622] Trial 111 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:43,717] Trial 112 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:43,810] Trial 113 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:43,900] Trial 114 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:43,989] Trial 115 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,080] Trial 116 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,171] Trial 117 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,261] Trial 118 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,352] Trial 119 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,437] Trial 120 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,520] Trial 121 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,618] Trial 122 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,714] Trial 123 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,799] Trial 124 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,885] Trial 125 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:44,974] Trial 126 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,061] Trial 127 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,147] Trial 128 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,231] Trial 129 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,314] Trial 130 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,407] Trial 131 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,498] Trial 132 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,584] Trial 133 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,672] Trial 134 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,769] Trial 135 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,863] Trial 136 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:45,953] Trial 137 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,039] Trial 138 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,131] Trial 139 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,221] Trial 140 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,311] Trial 141 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,409] Trial 142 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,509] Trial 143 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,609] Trial 144 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,707] Trial 145 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,804] Trial 146 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,902] Trial 147 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.
[I 2025-04-30 20:53:46,993] Trial 148 finished with value: 90.6923013121179 and parameters: {'u_0': 1, 'u_1': 0, 'u_2': 1, 'u_3': 1, 'u_4': 0, 'u_5': 1, 'u_6': 1, 'u_7': 0, 'u_8': 0, 'u_9': 0, 'u_10': 1, 'u_11': 1, 'u_12': 0, 'u_13': 0, 'u_14': 0, 'u_15': 0, 'u_16': 1, 'u_17': 0, 'u_18': 0, 'u_19': 1}. Best is trial 0 with value: 85.36578602312377.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Evaluating Initial Schedule ---
Initial Objective Value: 86.285501

--- Optimization Iteration 1 ---
Starting with schedule: [2 1 0 1 1 0 1 0 1 1 0 1 1 0 1 0 1 1 0 9]
Current best value to beat: 86.285501
Enqueued current schedule evaluation (Trial 0 for this iteration).
Running Optuna search (99 new trials)...
Iteration 1 Optuna run finished in 7.79 seconds.
Iteration 1 results: 75 completed trials out of 99 total.
  Best value found in iteration 1: 85.365786 (Trial #35)
  Improvement found! (86.285501 -&gt; 85.365786)
  Updated current_x_star for next iteration: [3 0 0 2 0 0 1 1 0 1 0 1 1 0 1 0 1 1 1 8]

--- Optimization Iteration 2 ---
Starting with schedule: [3 0 0 2 0 0 1 1 0 1 0 1 1 0 1 0 1 1 1 8]
Current best value to beat: 85.365786
Enqueued current schedule evaluation (Trial 0 for this iteration).
Running Optuna search (149 new trials)...
Iteration 2 Optuna run finished in 12.36 seconds.
Iteration 2 results: 61 completed trials out of 149 total.
  Best value found in iteration 2: 85.365786 (Trial #0)
  No significant improvement found over current best value (85.365786).

--- Iterative Optimization Finished ---
Stopping: No further improvement found in iteration 2.

--- Final Optimal Result ---
Found after iteration: 1
Final Objective Value: 85.365786
Final Optimal Schedule: [3 0 0 2 0 0 1 1 0 1 0 1 1 0 1 0 1 1 1 8]
Sum of Final Schedule: 22

Comparison with Initial Schedule:
  Initial Schedule (Iter 0): [2 1 0 1 1 0 1 0 1 1 0 1 1 0 1 0 1 1 0 9]
  Initial Objective Value:   86.285501
Total time taken for optimization: 20.25 seconds.

--- End of Script ---</code></pre>
</div>
</div>
<div id="e8212521" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing optimal solution with real cost</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> time.time()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>test_x <span class="op">=</span> local_search(x_star, d, convolutions, w, v_star, T, echo<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> time.time()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Time taken for local search: </span><span class="sc">{</span>end <span class="op">-</span> start<span class="sc">:.2f}</span><span class="ss"> seconds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initial solution: [2 1 0 1 1 0 1 0 1 1 0 1 1 0 1 0 1 1 0 9], cost: 86.28550068647573
Running local search with switching 1 patient(s)
Size of neighborhood: 13
Found better solution: [2 1 0 1 1 0 1 1 0 1 0 1 1 0 1 0 1 1 0 9], cost: 86.26085311991817
Running local search with switching 1 patient(s)
Size of neighborhood: 13
Found better solution: [2 1 0 1 1 0 1 1 0 1 1 0 1 0 1 0 1 1 0 9], cost: 86.22816418828928
Running local search with switching 1 patient(s)
Size of neighborhood: 13
Found better solution: [2 1 0 1 1 0 1 1 0 1 1 0 1 0 1 1 0 1 0 9], cost: 85.73622963909953
Running local search with switching 1 patient(s)
Size of neighborhood: 13
Found better solution: [2 1 0 1 1 0 1 1 0 1 1 0 1 1 0 1 0 1 0 9], cost: 85.61147253383554
Running local search with switching 1 patient(s)
Size of neighborhood: 13
Found better solution: [2 1 0 1 1 0 1 1 0 1 1 0 1 1 0 1 1 0 0 9], cost: 85.52091791603914
Running local search with switching 1 patient(s)
Size of neighborhood: 13
Found better solution: [2 1 0 1 1 0 1 1 0 1 1 0 1 1 0 1 1 0 1 8], cost: 82.55954781546124
Running local search with switching 1 patient(s)
Size of neighborhood: 14
Found better solution: [2 1 0 1 1 0 1 1 0 1 1 1 0 1 0 1 1 0 1 8], cost: 82.55848738270728
Running local search with switching 1 patient(s)
Size of neighborhood: 14
Found better solution: [2 1 0 1 1 0 1 1 1 0 1 1 0 1 0 1 1 0 1 8], cost: 82.54350314176841
Running local search with switching 1 patient(s)
Size of neighborhood: 14
Found better solution: [2 1 0 1 1 0 1 1 1 0 1 1 0 1 1 0 1 0 1 8], cost: 82.33115874538967
Running local search with switching 1 patient(s)
Size of neighborhood: 14
Found better solution: [2 1 0 1 1 1 0 1 1 0 1 1 0 1 1 0 1 0 1 8], cost: 82.32636977432377
Running local search with switching 1 patient(s)
Size of neighborhood: 14
Found better solution: [2 1 0 1 1 1 0 1 1 0 1 1 0 1 1 0 1 1 0 8], cost: 81.56143398064694
Running local search with switching 1 patient(s)
Size of neighborhood: 14
Found better solution: [2 1 0 1 1 1 0 1 1 0 1 1 0 1 1 1 0 1 0 8], cost: 81.46550942793334
Running local search with switching 1 patient(s)
Size of neighborhood: 14
Found better solution: [2 1 0 1 1 1 0 1 1 0 1 1 1 0 1 1 0 1 0 8], cost: 81.42558163058334
Running local search with switching 1 patient(s)
Size of neighborhood: 14
Found better solution: [2 1 0 1 1 1 0 1 1 0 1 1 1 0 1 1 0 1 1 7], cost: 79.92760812461681
Running local search with switching 1 patient(s)
Size of neighborhood: 15
Found better solution: [2 1 0 1 1 1 0 1 1 1 0 1 1 0 1 1 0 1 1 7], cost: 79.89530626489338
Running local search with switching 1 patient(s)
Size of neighborhood: 15
Found better solution: [2 1 0 1 1 1 0 1 1 1 0 1 1 0 1 1 1 0 1 7], cost: 79.62922740273407
Running local search with switching 1 patient(s)
Size of neighborhood: 15
Found better solution: [2 1 0 1 1 1 0 1 1 1 0 1 1 1 0 1 1 0 1 7], cost: 79.5749307192064
Running local search with switching 1 patient(s)
Size of neighborhood: 15
Found better solution: [2 1 0 1 1 1 0 1 1 1 0 1 1 1 0 1 1 1 0 7], cost: 79.33558572392224
Running local search with switching 1 patient(s)
Size of neighborhood: 15
Found better solution: [2 1 0 1 1 1 0 1 1 1 0 1 1 1 0 1 1 1 1 6], cost: 78.80296620804893
Running local search with switching 1 patient(s)
Size of neighborhood: 16
Found better solution: [2 1 1 0 1 1 0 1 1 1 0 1 1 1 0 1 1 1 1 6], cost: 78.80283143153545
Running local search with switching 1 patient(s)
Size of neighborhood: 16
Found better solution: [2 1 1 0 1 1 1 0 1 1 0 1 1 1 0 1 1 1 1 6], cost: 78.76220375391296
Running local search with switching 1 patient(s)
Size of neighborhood: 16
Found better solution: [2 1 1 0 1 1 1 0 1 1 1 0 1 1 0 1 1 1 1 6], cost: 78.72078179236607
Running local search with switching 1 patient(s)
Size of neighborhood: 16
Found better solution: [2 1 1 0 1 1 1 0 1 1 1 0 1 1 1 0 1 1 1 6], cost: 78.5922341160175
Running local search with switching 1 patient(s)
Size of neighborhood: 16
Found better solution: [2 1 1 0 1 1 1 0 1 1 1 0 1 1 1 1 0 1 1 6], cost: 78.5803552644775
Running local search with switching 1 patient(s)
Size of neighborhood: 16
Running local search with switching 2 patient(s)
Size of neighborhood: 124
Running local search with switching 3 patient(s)
Size of neighborhood: 620
Running local search with switching 4 patient(s)
Size of neighborhood: 2246
Running local search with switching 5 patient(s)
Size of neighborhood: 6272
Found better solution: [2 1 1 0 1 1 1 1 0 1 1 1 0 1 1 1 1 1 1 5], cost: 78.565295226485
Running local search with switching 1 patient(s)
Size of neighborhood: 17
Found better solution: [2 1 1 1 0 1 1 1 0 1 1 1 0 1 1 1 1 1 1 5], cost: 78.56441420169901
Running local search with switching 1 patient(s)
Size of neighborhood: 17
Running local search with switching 2 patient(s)
Size of neighborhood: 139
Running local search with switching 3 patient(s)
Size of neighborhood: 728
Running local search with switching 4 patient(s)
Size of neighborhood: 2743
Running local search with switching 5 patient(s)
Size of neighborhood: 7913
Running local search with switching 6 patient(s)
Size of neighborhood: 18152
Running local search with switching 7 patient(s)
Size of neighborhood: 33931
Running local search with switching 8 patient(s)
Size of neighborhood: 52520
Running local search with switching 9 patient(s)
Size of neighborhood: 68003
Running local search with switching 10 patient(s)
Size of neighborhood: 74074
Running local search with switching 11 patient(s)
Size of neighborhood: 68003
Running local search with switching 12 patient(s)
Size of neighborhood: 52520
Running local search with switching 13 patient(s)
Size of neighborhood: 33931
Running local search with switching 14 patient(s)
Size of neighborhood: 18152
Running local search with switching 15 patient(s)
Size of neighborhood: 7913
Running local search with switching 16 patient(s)
Size of neighborhood: 2743
Running local search with switching 17 patient(s)
Size of neighborhood: 728
Running local search with switching 18 patient(s)
Size of neighborhood: 139
Running local search with switching 19 patient(s)
Size of neighborhood: 17
Time taken for local search: 222.51 seconds</code></pre>
</div>
</div>
<div id="ab6815cc" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">32</span> <span class="co"># Number of patients</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">30</span> <span class="co"># Number of intervals</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="dv">5</span> <span class="co"># Length of each interval</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>max_s <span class="op">=</span> <span class="dv">20</span> <span class="co"># Maximum service time</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.20</span> <span class="co"># Probability of a scheduled patient not showing up</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># Weight for the waiting time in objective function</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>v_star <span class="op">=</span> get_v_star(T)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"v_star: </span><span class="ch">\n</span><span class="st">"</span>, v_star)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">5</span>  <span class="co"># First 5 highest values in ascending order, rest in descending order</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> generate_weighted_list(max_s, l, i)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(s)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sum:"</span>, np.<span class="bu">sum</span>(s[<span class="dv">1</span>:]))  <span class="co"># This should be 1</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Weighted service time:"</span>, np.dot(np.arange(<span class="bu">len</span>(s)), s))  <span class="co"># This should be close to l</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>x_star <span class="op">=</span> bailey_welch_schedule(T, d, N, s)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Initial schedule: </span><span class="sc">{</span>x_star<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>convolutions <span class="op">=</span> compute_convolutions(s, N, q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>v_star: 
 [[-1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  1]
 [ 1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1  0
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1 -1
   0  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1
  -1  0  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   1 -1  0  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  1 -1  0  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  1 -1  0  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  1 -1  0]
 [ 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
   0  0  0  0  1 -1]]
[0.         0.00977138 0.03217181 0.04656083 0.05733981 0.11729773
 0.16431082 0.11103357 0.09521906 0.08238357 0.06545485 0.06067393
 0.05599076 0.0198752  0.0164291  0.01460479 0.01378266 0.01324911
 0.01316457 0.00604428 0.00464217]
Sum: 1.0000000000210227
Weighted service time: 7.887661979514329
Initial schedule: [2, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 12]</code></pre>
</div>
</div>
<div id="fd6020fc" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x_star <span class="op">=</span> np.array(x_star)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>duration_threshold <span class="op">=</span> d <span class="co"># Use 'd' from initialization</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> w             <span class="co"># Use 'w' from initialization</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>conv_dict <span class="op">=</span> convolutions <span class="co"># Use 'convolutions' from initialization</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>num_u_variables <span class="op">=</span> v_star.shape[<span class="dv">0</span>]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Optuna Objective Factory Function</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_objective(</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    initial_x_star: np.ndarray,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    modification_v_star: np.ndarray,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    objective_weight: <span class="bu">float</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    slot_duration: <span class="bu">int</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    conv_dict: Dict[<span class="bu">int</span>, np.ndarray]</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> Callable[[optuna.trial.Trial], <span class="bu">float</span>]:</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" Creates the objective function for Optuna, capturing problem parameters. """</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    internal_num_u <span class="op">=</span> modification_v_star.shape[<span class="dv">0</span>]</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure initial_x_star is 1D for consistent addition</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    base_schedule <span class="op">=</span> initial_x_star.flatten()</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> objective(trial: optuna.trial.Trial) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">""" The function Optuna minimizes. """</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1. Suggest u</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        U <span class="op">=</span> np.array([trial.suggest_int(<span class="ss">f"u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(internal_num_u)])</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        u_column <span class="op">=</span> U.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 2. Calculate r_u</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> modification_v_star.shape[<span class="dv">0</span>] <span class="op">!=</span> u_column.shape[<span class="dv">0</span>]:</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>             msg <span class="op">=</span> <span class="ss">f"Dimension mismatch: v_star rows (</span><span class="sc">{</span>modification_v_star<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">) != u vector length (</span><span class="sc">{</span>u_column<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>             logging.error(msg)</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>             <span class="cf">raise</span> optuna.exceptions.TrialPruned(msg)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>        r_u <span class="op">=</span> modification_v_star <span class="op">*</span> u_column</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3. Sum r_u columns</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        r_u_col_sum <span class="op">=</span> np.<span class="bu">sum</span>(r_u, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 4. Calculate neighbor</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> base_schedule.shape <span class="op">!=</span> r_u_col_sum.shape:</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>            msg <span class="op">=</span> <span class="ss">f"Dimension mismatch: base schedule shape (</span><span class="sc">{</span>base_schedule<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">) != adjustment shape (</span><span class="sc">{</span>r_u_col_sum<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>            logging.error(msg)</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> optuna.exceptions.TrialPruned(msg)</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>        neighbor_schedule <span class="op">=</span> base_schedule <span class="op">+</span> r_u_col_sum</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 5. Constraint Check</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.<span class="bu">any</span>(neighbor_schedule <span class="op">&lt;</span> <span class="dv">0</span>):</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>            message <span class="op">=</span> <span class="ss">f"Constraint violation: Resulting schedule &lt; 0: </span><span class="sc">{</span>neighbor_schedule<span class="sc">}</span><span class="ss"> (u=</span><span class="sc">{</span>U<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Log constraint violations at DEBUG level if needed, requires setting basicConfig level=logging.DEBUG</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>            logging.debug(<span class="ss">f"Trial </span><span class="sc">{</span>trial<span class="sc">.</span>number<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>message<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> optuna.exceptions.TrialPruned(message)</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 6. Evaluate</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>            ewt, esp <span class="op">=</span> calculate_objective_serv_time_lookup(</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>                schedule<span class="op">=</span>neighbor_schedule,</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>                d<span class="op">=</span>slot_duration,</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>                convolutions<span class="op">=</span>conv_dict</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>            ewt <span class="op">=</span> <span class="bu">float</span>(ewt)<span class="op">;</span> esp <span class="op">=</span> <span class="bu">float</span>(esp)</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> ewt <span class="op">!=</span> ewt <span class="kw">or</span> esp <span class="op">!=</span> esp: <span class="co"># Check for NaN</span></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Objective calculation resulted in NaN."</span>)</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>            logging.warning(<span class="ss">f"Trial </span><span class="sc">{</span>trial<span class="sc">.</span>number<span class="sc">}</span><span class="ss">: Error during evaluation for schedule </span><span class="sc">{</span>neighbor_schedule<span class="sc">}</span><span class="ss"> (u=</span><span class="sc">{</span>U<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> optuna.exceptions.TrialPruned(<span class="ss">f"Evaluation failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e_gen:</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>             logging.error(<span class="ss">f"Trial </span><span class="sc">{</span>trial<span class="sc">.</span>number<span class="sc">}</span><span class="ss">: Unexpected error during evaluation for schedule </span><span class="sc">{</span>neighbor_schedule<span class="sc">}</span><span class="ss"> (u=</span><span class="sc">{</span>U<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>e_gen<span class="sc">}</span><span class="ss">"</span>, exc_info<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>             <span class="cf">raise</span> optuna.exceptions.TrialPruned(<span class="ss">f"Unexpected evaluation error: </span><span class="sc">{</span>e_gen<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 7. Calculate final objective</span></span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>        objective_value <span class="op">=</span> objective_weight <span class="op">*</span> ewt <span class="op">+</span> (<span class="dv">1</span> <span class="op">-</span> objective_weight) <span class="op">*</span> esp</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> objective_value</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> objective <span class="co"># Return the nested function</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Main Execution Block</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Configure Logging (File Only) ---</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>log_file <span class="op">=</span> <span class="st">'optuna_vns.log'</span></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>logging.basicConfig(</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>logging.INFO,  <span class="co"># Log INFO level and above TO FILE</span></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%(asctime)s</span><span class="st"> - </span><span class="sc">%(levelname)s</span><span class="st"> - </span><span class="sc">%(message)s</span><span class="st">'</span>,</span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>    filename<span class="op">=</span>log_file,</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>    filemode<span class="op">=</span><span class="st">'w'</span>  <span class="co"># 'w' clears the file each time</span></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a><span class="co"># DO NOT add the console handler if you only want specific prints in Quarto</span></span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="st">"Optuna VNS script started."</span>)</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Optuna VNS script started."</span>) <span class="co"># Print start message to Quarto output</span></span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Iterative Optimization Loop Variables ---</span></span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>start_time_total <span class="op">=</span> time.time()</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>max_iterations <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>tolerance <span class="op">=</span> <span class="fl">1e-8</span></span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>n_trials_per_iteration <span class="op">=</span> <span class="dv">299</span> <span class="co"># Initial number of *new* trials</span></span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>iteration <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>improvement_found <span class="op">=</span> <span class="va">True</span></span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>current_x_star <span class="op">=</span> x_star.copy()</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>current_best_value <span class="op">=</span> <span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> []</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Initial Evaluation ---</span></span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Evaluating Initial Schedule ---"</span>)</span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Evaluating Initial Schedule ---"</span>) <span class="co"># Print header to Quarto</span></span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>initial_eval_success <span class="op">=</span> <span class="va">False</span></span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Suppress Optuna's default INFO logging during optimize</span></span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>    optuna.logging.set_verbosity(optuna.logging.WARNING)</span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>    initial_study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>, study_name<span class="op">=</span><span class="st">"Initial_Eval"</span>)</span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>    initial_objective_func <span class="op">=</span> create_objective(</span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a>        initial_x_star<span class="op">=</span>current_x_star,</span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>        modification_v_star<span class="op">=</span>v_star,</span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>        objective_weight<span class="op">=</span>weight,</span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>        slot_duration<span class="op">=</span>duration_threshold,</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>        conv_dict<span class="op">=</span>conv_dict</span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>    initial_params <span class="op">=</span> {<span class="ss">f"u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>: <span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_u_variables)}</span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>    initial_study.enqueue_trial(initial_params)</span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>    initial_study.optimize(initial_objective_func, n_trials<span class="op">=</span><span class="dv">1</span>, timeout<span class="op">=</span><span class="dv">60</span>) <span class="co"># Add timeout</span></span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Restore Optuna logging verbosity</span></span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>    optuna.logging.set_verbosity(optuna.logging.INFO)</span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>    initial_trial <span class="op">=</span> initial_study.trials[<span class="dv">0</span>]</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> initial_trial.state <span class="op">==</span> optuna.trial.TrialState.COMPLETE:</span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>        current_best_value <span class="op">=</span> initial_trial.value</span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Initial Objective Value: </span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Initial Schedule: </span><span class="sc">{</span>current_x_star<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Print initial state to Quarto</span></span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Initial Objective Value: </span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss">"</span>) <span class="co"># Print initial value to Quarto</span></span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a>        history.append((iteration, current_best_value, current_x_star.copy()))</span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a>        initial_eval_success <span class="op">=</span> <span class="va">True</span></span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>        logging.error(<span class="ss">f"Could not evaluate initial schedule successfully. State: </span><span class="sc">{</span>initial_trial<span class="sc">.</span>state<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"ERROR: Could not evaluate initial schedule successfully. State: </span><span class="sc">{</span>initial_trial<span class="sc">.</span>state<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Print error</span></span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> initial_trial.state <span class="op">==</span> optuna.trial.TrialState.PRUNED:</span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a>             <span class="cf">try</span>: logging.error(<span class="ss">f"  Pruning reason: </span><span class="sc">{</span>initial_trial<span class="sc">.</span>user_attrs<span class="sc">.</span>get(<span class="st">'pruned_reason'</span>, <span class="st">'N/A'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a>             <span class="cf">except</span>: <span class="cf">pass</span></span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>        improvement_found <span class="op">=</span> <span class="va">False</span> <span class="co"># Stop if initial eval fails</span></span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Restore Optuna logging verbosity even on error</span></span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a>    optuna.logging.set_verbosity(optuna.logging.INFO)</span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a>    logging.error(<span class="ss">f"An unexpected error occurred during initial evaluation: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>, exc_info<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"ERROR: An unexpected error occurred during initial evaluation: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Print error</span></span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a>    improvement_found <span class="op">=</span> <span class="va">False</span> <span class="co"># Stop</span></span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> initial_eval_success:</span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a>     <span class="bu">print</span>(<span class="st">"Stopping due to failure in initial evaluation."</span>)</span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a>     sys.exit(<span class="st">"Initial evaluation failed."</span>)</span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Iterative Optimization Loop ---</span></span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> improvement_found <span class="kw">and</span> iteration <span class="op">&lt;</span> max_iterations:</span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a>    iteration <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Print Iteration Start Summary to Quarto ---</span></span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Optimization Iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss"> ---"</span>)</span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Starting with schedule: </span><span class="sc">{</span>current_x_star<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Current best value to beat: </span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Log detailed info ---</span></span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Optimization Iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss"> ---"</span>)</span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"Starting with schedule: </span><span class="sc">{</span>current_x_star<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"Current best value to beat: </span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb22-165"><a href="#cb22-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-166"><a href="#cb22-166" aria-hidden="true" tabindex="-1"></a>    improvement_found_this_iter <span class="op">=</span> <span class="va">False</span> <span class="co"># Reset flag</span></span>
<span id="cb22-167"><a href="#cb22-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-168"><a href="#cb22-168" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Create new study and objective</span></span>
<span id="cb22-169"><a href="#cb22-169" aria-hidden="true" tabindex="-1"></a>    study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">"minimize"</span>, study_name<span class="op">=</span><span class="ss">f"Sched_Opt_Iter_</span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-170"><a href="#cb22-170" aria-hidden="true" tabindex="-1"></a>    objective_func <span class="op">=</span> create_objective(</span>
<span id="cb22-171"><a href="#cb22-171" aria-hidden="true" tabindex="-1"></a>        initial_x_star<span class="op">=</span>current_x_star, <span class="co"># Use current best</span></span>
<span id="cb22-172"><a href="#cb22-172" aria-hidden="true" tabindex="-1"></a>        modification_v_star<span class="op">=</span>v_star,</span>
<span id="cb22-173"><a href="#cb22-173" aria-hidden="true" tabindex="-1"></a>        objective_weight<span class="op">=</span>weight,</span>
<span id="cb22-174"><a href="#cb22-174" aria-hidden="true" tabindex="-1"></a>        slot_duration<span class="op">=</span>duration_threshold,</span>
<span id="cb22-175"><a href="#cb22-175" aria-hidden="true" tabindex="-1"></a>        conv_dict<span class="op">=</span>conv_dict</span>
<span id="cb22-176"><a href="#cb22-176" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-177"><a href="#cb22-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-178"><a href="#cb22-178" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Enqueue trial for the current schedule (U=0)</span></span>
<span id="cb22-179"><a href="#cb22-179" aria-hidden="true" tabindex="-1"></a>    params_to_enqueue <span class="op">=</span> {<span class="ss">f"u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>: <span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_u_variables)}</span>
<span id="cb22-180"><a href="#cb22-180" aria-hidden="true" tabindex="-1"></a>    study.enqueue_trial(params_to_enqueue)</span>
<span id="cb22-181"><a href="#cb22-181" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"Enqueued current schedule evaluation (Trial 0 for this iteration)."</span>)</span>
<span id="cb22-182"><a href="#cb22-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-183"><a href="#cb22-183" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Run Optuna optimization</span></span>
<span id="cb22-184"><a href="#cb22-184" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"Running Optuna search (</span><span class="sc">{</span>n_trials_per_iteration<span class="sc">}</span><span class="ss"> new trials)..."</span>)</span>
<span id="cb22-185"><a href="#cb22-185" aria-hidden="true" tabindex="-1"></a>    start_time_iter <span class="op">=</span> time.time()</span>
<span id="cb22-186"><a href="#cb22-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb22-187"><a href="#cb22-187" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Suppress Optuna's default INFO logging during optimize</span></span>
<span id="cb22-188"><a href="#cb22-188" aria-hidden="true" tabindex="-1"></a>        optuna.logging.set_verbosity(optuna.logging.WARNING)</span>
<span id="cb22-189"><a href="#cb22-189" aria-hidden="true" tabindex="-1"></a>        study.optimize(objective_func, n_trials<span class="op">=</span>n_trials_per_iteration, timeout<span class="op">=</span><span class="dv">300</span>) <span class="co"># Add timeout</span></span>
<span id="cb22-190"><a href="#cb22-190" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Restore Optuna logging verbosity</span></span>
<span id="cb22-191"><a href="#cb22-191" aria-hidden="true" tabindex="-1"></a>        optuna.logging.set_verbosity(optuna.logging.INFO)</span>
<span id="cb22-192"><a href="#cb22-192" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb22-193"><a href="#cb22-193" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Restore Optuna logging verbosity even on error</span></span>
<span id="cb22-194"><a href="#cb22-194" aria-hidden="true" tabindex="-1"></a>        optuna.logging.set_verbosity(optuna.logging.INFO)</span>
<span id="cb22-195"><a href="#cb22-195" aria-hidden="true" tabindex="-1"></a>        logging.error(<span class="ss">f"Error during Optuna run in iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>, exc_info<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-196"><a href="#cb22-196" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"ERROR: Error during Optuna run in iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Print error</span></span>
<span id="cb22-197"><a href="#cb22-197" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span> <span class="co"># Stop loop on error</span></span>
<span id="cb22-198"><a href="#cb22-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">finally</span>:</span>
<span id="cb22-199"><a href="#cb22-199" aria-hidden="true" tabindex="-1"></a>        end_time_iter <span class="op">=</span> time.time()</span>
<span id="cb22-200"><a href="#cb22-200" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss"> Optuna run finished in </span><span class="sc">{</span>end_time_iter <span class="op">-</span> start_time_iter<span class="sc">:.2f}</span><span class="ss"> seconds."</span>)</span>
<span id="cb22-201"><a href="#cb22-201" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Increment trials for next iteration</span></span>
<span id="cb22-202"><a href="#cb22-202" aria-hidden="true" tabindex="-1"></a>        n_trials_per_iteration <span class="op">+=</span> <span class="dv">40</span> <span class="co"># Consider if this increment logic is correct</span></span>
<span id="cb22-203"><a href="#cb22-203" aria-hidden="true" tabindex="-1"></a>        logging.info(<span class="ss">f"Increased trials for next iteration to: </span><span class="sc">{</span>n_trials_per_iteration<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-204"><a href="#cb22-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-205"><a href="#cb22-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-206"><a href="#cb22-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Process results</span></span>
<span id="cb22-207"><a href="#cb22-207" aria-hidden="true" tabindex="-1"></a>    completed_trials <span class="op">=</span> [t <span class="cf">for</span> t <span class="kw">in</span> study.trials <span class="cf">if</span> t.state <span class="op">==</span> optuna.trial.TrialState.COMPLETE]</span>
<span id="cb22-208"><a href="#cb22-208" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"Iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss"> results: </span><span class="sc">{</span><span class="bu">len</span>(completed_trials)<span class="sc">}</span><span class="ss"> completed trials out of </span><span class="sc">{</span><span class="bu">len</span>(study.trials)<span class="sc">}</span><span class="ss"> total."</span>)</span>
<span id="cb22-209"><a href="#cb22-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-210"><a href="#cb22-210" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Print Iteration End Summary to Quarto ---</span></span>
<span id="cb22-211"><a href="#cb22-211" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss"> Summary:"</span>)</span>
<span id="cb22-212"><a href="#cb22-212" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Completed trials: </span><span class="sc">{</span><span class="bu">len</span>(completed_trials)<span class="sc">}</span><span class="ss"> / </span><span class="sc">{</span><span class="bu">len</span>(study.trials)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-213"><a href="#cb22-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-214"><a href="#cb22-214" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> completed_trials:</span>
<span id="cb22-215"><a href="#cb22-215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb22-216"><a href="#cb22-216" aria-hidden="true" tabindex="-1"></a>             best_trial_iter <span class="op">=</span> study.best_trial</span>
<span id="cb22-217"><a href="#cb22-217" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span> best_trial_iter.state <span class="op">!=</span> optuna.trial.TrialState.COMPLETE:</span>
<span id="cb22-218"><a href="#cb22-218" aria-hidden="true" tabindex="-1"></a>                  completed_trials.sort(key<span class="op">=</span><span class="kw">lambda</span> t: t.value)</span>
<span id="cb22-219"><a href="#cb22-219" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">if</span> completed_trials: best_trial_iter <span class="op">=</span> completed_trials[<span class="dv">0</span>]</span>
<span id="cb22-220"><a href="#cb22-220" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">else</span>: <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"No completed trials found."</span>)</span>
<span id="cb22-221"><a href="#cb22-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-222"><a href="#cb22-222" aria-hidden="true" tabindex="-1"></a>             best_value_iter <span class="op">=</span> best_trial_iter.value</span>
<span id="cb22-223"><a href="#cb22-223" aria-hidden="true" tabindex="-1"></a>             logging.info(<span class="ss">f"  Best value found in iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>best_value_iter<span class="sc">:.6f}</span><span class="ss"> (Trial #</span><span class="sc">{</span>best_trial_iter<span class="sc">.</span>number<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb22-224"><a href="#cb22-224" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>(<span class="ss">f"  Best value found this iteration: </span><span class="sc">{</span>best_value_iter<span class="sc">:.6f}</span><span class="ss">"</span>) <span class="co"># Print iter best value</span></span>
<span id="cb22-225"><a href="#cb22-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-226"><a href="#cb22-226" aria-hidden="true" tabindex="-1"></a>             <span class="co"># 5. Check for improvement</span></span>
<span id="cb22-227"><a href="#cb22-227" aria-hidden="true" tabindex="-1"></a>             <span class="cf">if</span> best_value_iter <span class="op">&lt;</span> current_best_value <span class="op">-</span> tolerance:</span>
<span id="cb22-228"><a href="#cb22-228" aria-hidden="true" tabindex="-1"></a>                logging.info(<span class="ss">f"  Improvement found! (</span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss"> -&gt; </span><span class="sc">{</span>best_value_iter<span class="sc">:.6f}</span><span class="ss">)"</span>)</span>
<span id="cb22-229"><a href="#cb22-229" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"  Improvement Found: Yes (</span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss"> -&gt; </span><span class="sc">{</span>best_value_iter<span class="sc">:.6f}</span><span class="ss">)"</span>) <span class="co"># Print improvement status</span></span>
<span id="cb22-230"><a href="#cb22-230" aria-hidden="true" tabindex="-1"></a>                improvement_found_this_iter <span class="op">=</span> <span class="va">True</span></span>
<span id="cb22-231"><a href="#cb22-231" aria-hidden="true" tabindex="-1"></a>                current_best_value <span class="op">=</span> best_value_iter</span>
<span id="cb22-232"><a href="#cb22-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-233"><a href="#cb22-233" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Calculate the schedule that yielded this improvement</span></span>
<span id="cb22-234"><a href="#cb22-234" aria-hidden="true" tabindex="-1"></a>                best_params_u <span class="op">=</span> best_trial_iter.params</span>
<span id="cb22-235"><a href="#cb22-235" aria-hidden="true" tabindex="-1"></a>                best_u_list <span class="op">=</span> [best_params_u.get(<span class="ss">f'u_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>, <span class="dv">0</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_u_variables)]</span>
<span id="cb22-236"><a href="#cb22-236" aria-hidden="true" tabindex="-1"></a>                best_u_np <span class="op">=</span> np.array(best_u_list)</span>
<span id="cb22-237"><a href="#cb22-237" aria-hidden="true" tabindex="-1"></a>                best_u_column <span class="op">=</span> best_u_np.reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb22-238"><a href="#cb22-238" aria-hidden="true" tabindex="-1"></a>                best_r_u <span class="op">=</span> v_star <span class="op">*</span> best_u_column</span>
<span id="cb22-239"><a href="#cb22-239" aria-hidden="true" tabindex="-1"></a>                best_r_u_col_sum <span class="op">=</span> np.<span class="bu">sum</span>(best_r_u, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb22-240"><a href="#cb22-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-241"><a href="#cb22-241" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Update current_x_star for the NEXT iteration</span></span>
<span id="cb22-242"><a href="#cb22-242" aria-hidden="true" tabindex="-1"></a>                current_x_star <span class="op">=</span> current_x_star <span class="op">+</span> best_r_u_col_sum <span class="co"># Make sure shapes match</span></span>
<span id="cb22-243"><a href="#cb22-243" aria-hidden="true" tabindex="-1"></a>                logging.info(<span class="ss">f"  Updated current_x_star for next iteration: </span><span class="sc">{</span>current_x_star<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-244"><a href="#cb22-244" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Don't print the updated x_star here, print it at the *start* of the next iteration</span></span>
<span id="cb22-245"><a href="#cb22-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-246"><a href="#cb22-246" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Optional: Store history</span></span>
<span id="cb22-247"><a href="#cb22-247" aria-hidden="true" tabindex="-1"></a>                history.append((iteration, current_best_value, current_x_star.copy()))</span>
<span id="cb22-248"><a href="#cb22-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-249"><a href="#cb22-249" aria-hidden="true" tabindex="-1"></a>             <span class="cf">else</span>:</span>
<span id="cb22-250"><a href="#cb22-250" aria-hidden="true" tabindex="-1"></a>                <span class="co"># No significant improvement found</span></span>
<span id="cb22-251"><a href="#cb22-251" aria-hidden="true" tabindex="-1"></a>                logging.info(<span class="ss">f"  No significant improvement found over current best value (</span><span class="sc">{</span>current_best_value<span class="sc">:.6f}</span><span class="ss">)."</span>)</span>
<span id="cb22-252"><a href="#cb22-252" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"  Improvement Found: No"</span>) <span class="co"># Print improvement status</span></span>
<span id="cb22-253"><a href="#cb22-253" aria-hidden="true" tabindex="-1"></a>                improvement_found_this_iter <span class="op">=</span> <span class="va">False</span></span>
<span id="cb22-254"><a href="#cb22-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-255"><a href="#cb22-255" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb22-256"><a href="#cb22-256" aria-hidden="true" tabindex="-1"></a>             logging.warning(<span class="ss">f"Could not determine best trial/value in iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-257"><a href="#cb22-257" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>(<span class="ss">f"  Warning: Could not determine best trial/value in iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">."</span>) <span class="co"># Print warning</span></span>
<span id="cb22-258"><a href="#cb22-258" aria-hidden="true" tabindex="-1"></a>             improvement_found_this_iter <span class="op">=</span> <span class="va">False</span></span>
<span id="cb22-259"><a href="#cb22-259" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e_inner:</span>
<span id="cb22-260"><a href="#cb22-260" aria-hidden="true" tabindex="-1"></a>             logging.error(<span class="ss">f"Unexpected error processing results for iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e_inner<span class="sc">}</span><span class="ss">"</span>, exc_info<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-261"><a href="#cb22-261" aria-hidden="true" tabindex="-1"></a>             <span class="bu">print</span>(<span class="ss">f"  ERROR: Unexpected error processing results for iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">."</span>) <span class="co"># Print error</span></span>
<span id="cb22-262"><a href="#cb22-262" aria-hidden="true" tabindex="-1"></a>             improvement_found_this_iter <span class="op">=</span> <span class="va">False</span></span>
<span id="cb22-263"><a href="#cb22-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-264"><a href="#cb22-264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-265"><a href="#cb22-265" aria-hidden="true" tabindex="-1"></a>        <span class="co"># No trials completed successfully</span></span>
<span id="cb22-266"><a href="#cb22-266" aria-hidden="true" tabindex="-1"></a>        logging.warning(<span class="st">"  No trials completed successfully in this iteration. Stopping."</span>)</span>
<span id="cb22-267"><a href="#cb22-267" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"  Warning: No trials completed successfully in this iteration."</span>) <span class="co"># Print warning</span></span>
<span id="cb22-268"><a href="#cb22-268" aria-hidden="true" tabindex="-1"></a>        improvement_found_this_iter <span class="op">=</span> <span class="va">False</span></span>
<span id="cb22-269"><a href="#cb22-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-270"><a href="#cb22-270" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update master loop flag</span></span>
<span id="cb22-271"><a href="#cb22-271" aria-hidden="true" tabindex="-1"></a>    improvement_found <span class="op">=</span> improvement_found_this_iter</span>
<span id="cb22-272"><a href="#cb22-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-273"><a href="#cb22-273" aria-hidden="true" tabindex="-1"></a><span class="co"># --- End of Loop ---</span></span>
<span id="cb22-274"><a href="#cb22-274" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Iterative Optimization Finished ---"</span>)</span>
<span id="cb22-275"><a href="#cb22-275" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Iterative Optimization Finished ---"</span>) <span class="co"># Print header to Quarto</span></span>
<span id="cb22-276"><a href="#cb22-276" aria-hidden="true" tabindex="-1"></a>stop_reason <span class="op">=</span> <span class="st">""</span></span>
<span id="cb22-277"><a href="#cb22-277" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> iteration <span class="op">&gt;=</span> max_iterations:</span>
<span id="cb22-278"><a href="#cb22-278" aria-hidden="true" tabindex="-1"></a>    stop_reason <span class="op">=</span> <span class="ss">f"Reached maximum iteration limit (</span><span class="sc">{</span>max_iterations<span class="sc">}</span><span class="ss">)."</span></span>
<span id="cb22-279"><a href="#cb22-279" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> <span class="kw">not</span> improvement_found:</span>
<span id="cb22-280"><a href="#cb22-280" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(history) <span class="op">&gt;</span> <span class="dv">1</span>: stop_reason <span class="op">=</span> <span class="ss">f"No further improvement found in iteration </span><span class="sc">{</span>iteration<span class="sc">}</span><span class="ss">."</span></span>
<span id="cb22-281"><a href="#cb22-281" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: stop_reason <span class="op">=</span> <span class="ss">f"No improvement found after initial evaluation (or initial eval failed)."</span></span>
<span id="cb22-282"><a href="#cb22-282" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>: stop_reason <span class="op">=</span> <span class="st">"Loop finished for unexpected reasons."</span></span>
<span id="cb22-283"><a href="#cb22-283" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="ss">f"Stopping: </span><span class="sc">{</span>stop_reason<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-284"><a href="#cb22-284" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Stopping Reason: </span><span class="sc">{</span>stop_reason<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Print stop reason to Quarto</span></span>
<span id="cb22-285"><a href="#cb22-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-286"><a href="#cb22-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-287"><a href="#cb22-287" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Final Results ---</span></span>
<span id="cb22-288"><a href="#cb22-288" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Final Optimal Result ---"</span>)</span>
<span id="cb22-289"><a href="#cb22-289" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Final Optimal Result ---"</span>) <span class="co"># Print header to Quarto</span></span>
<span id="cb22-290"><a href="#cb22-290" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> history: <span class="co"># Check if any results were recorded</span></span>
<span id="cb22-291"><a href="#cb22-291" aria-hidden="true" tabindex="-1"></a>    final_iter, final_value, final_schedule <span class="op">=</span> history[<span class="op">-</span><span class="dv">1</span>] <span class="co"># Get last recorded state</span></span>
<span id="cb22-292"><a href="#cb22-292" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Log details</span></span>
<span id="cb22-293"><a href="#cb22-293" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"Found after iteration: </span><span class="sc">{</span>final_iter<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-294"><a href="#cb22-294" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"Final Objective Value: </span><span class="sc">{</span>final_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb22-295"><a href="#cb22-295" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"Final Optimal Schedule: </span><span class="sc">{</span>final_schedule<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-296"><a href="#cb22-296" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"Sum of Final Schedule: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(final_schedule)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-297"><a href="#cb22-297" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="st">"</span><span class="ch">\n</span><span class="st">Comparison with Initial Schedule:"</span>)</span>
<span id="cb22-298"><a href="#cb22-298" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"  Initial Schedule (Iter 0): </span><span class="sc">{</span>history[<span class="dv">0</span>][<span class="dv">2</span>]<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-299"><a href="#cb22-299" aria-hidden="true" tabindex="-1"></a>    logging.info(<span class="ss">f"  Initial Objective Value:  </span><span class="sc">{</span>history[<span class="dv">0</span>][<span class="dv">1</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb22-300"><a href="#cb22-300" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print summary</span></span>
<span id="cb22-301"><a href="#cb22-301" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Found after iteration: </span><span class="sc">{</span>final_iter<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-302"><a href="#cb22-302" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Final Objective Value: </span><span class="sc">{</span>final_value<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb22-303"><a href="#cb22-303" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Final Optimal Schedule: </span><span class="sc">{</span>final_schedule<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-304"><a href="#cb22-304" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Sum of Final Schedule: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(final_schedule)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-305"><a href="#cb22-305" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Comparison with Initial Schedule:"</span>)</span>
<span id="cb22-306"><a href="#cb22-306" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Initial Schedule (Iter 0): </span><span class="sc">{</span>history[<span class="dv">0</span>][<span class="dv">2</span>]<span class="sc">.</span>astype(<span class="bu">int</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-307"><a href="#cb22-307" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Initial Objective Value:   </span><span class="sc">{</span>history[<span class="dv">0</span>][<span class="dv">1</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb22-308"><a href="#cb22-308" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb22-309"><a href="#cb22-309" aria-hidden="true" tabindex="-1"></a>    logging.warning(<span class="st">"No results found (Initial evaluation might have failed or no iterations ran)."</span>)</span>
<span id="cb22-310"><a href="#cb22-310" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Warning: No results recorded in history."</span>) <span class="co"># Print warning</span></span>
<span id="cb22-311"><a href="#cb22-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-312"><a href="#cb22-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-313"><a href="#cb22-313" aria-hidden="true" tabindex="-1"></a>end_time_total <span class="op">=</span> time.time()</span>
<span id="cb22-314"><a href="#cb22-314" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="ss">f"Total time taken for optimization: </span><span class="sc">{</span>end_time_total <span class="op">-</span> start_time_total<span class="sc">:.2f}</span><span class="ss"> seconds."</span>)</span>
<span id="cb22-315"><a href="#cb22-315" aria-hidden="true" tabindex="-1"></a>logging.info(<span class="st">"</span><span class="ch">\n</span><span class="st">--- End of Script ---"</span>)</span>
<span id="cb22-316"><a href="#cb22-316" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Total time taken: </span><span class="sc">{</span>end_time_total <span class="op">-</span> start_time_total<span class="sc">:.2f}</span><span class="ss"> seconds."</span>) <span class="co"># Print total time</span></span>
<span id="cb22-317"><a href="#cb22-317" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Script finished. Check log file: </span><span class="sc">{</span>log_file<span class="sc">}</span><span class="ss">"</span>) <span class="co"># Final confirmation print</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2025-04-30 20:57:29,612] A new study created in memory with name: Sched_Opt_Iter_1
[I 2025-04-30 20:58:08,140] A new study created in memory with name: Sched_Opt_Iter_2
[I 2025-04-30 20:58:54,206] A new study created in memory with name: Sched_Opt_Iter_3
[I 2025-04-30 20:59:51,170] A new study created in memory with name: Sched_Opt_Iter_4
[I 2025-04-30 21:00:56,542] A new study created in memory with name: Sched_Opt_Iter_5
[I 2025-04-30 21:02:06,551] A new study created in memory with name: Sched_Opt_Iter_6
[I 2025-04-30 21:03:25,123] A new study created in memory with name: Sched_Opt_Iter_7
[I 2025-04-30 21:04:53,581] A new study created in memory with name: Sched_Opt_Iter_8
[I 2025-04-30 21:06:24,839] A new study created in memory with name: Sched_Opt_Iter_9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Optuna VNS script started.

--- Evaluating Initial Schedule ---
Initial Schedule: [ 2  1  0  1  1  0  1  1  0  1  0  1  1  0  1  1  0  1  1  0  1  0  1  1
  0  1  1  0  1 12]
Initial Objective Value: 129.616790

--- Optimization Iteration 1 ---
Starting with schedule: [ 2  1  0  1  1  0  1  1  0  1  0  1  1  0  1  1  0  1  1  0  1  0  1  1
  0  1  1  0  1 12]
Current best value to beat: 129.616790
Iteration 1 Summary:
  Completed trials: 241 / 299
  Best value found this iteration: 126.772827
  Improvement Found: Yes (129.616790 -&gt; 126.772827)

--- Optimization Iteration 2 ---
Starting with schedule: [ 2  1  0  1  1  0  1  1  0  1  0  1  1  0  1  1  1  1  0  1  1  0  1  0
  0  2  0  1  1 11]
Current best value to beat: 126.772827
Iteration 2 Summary:
  Completed trials: 305 / 339
  Best value found this iteration: 121.270205
  Improvement Found: Yes (126.772827 -&gt; 121.270205)

--- Optimization Iteration 3 ---
Starting with schedule: [ 3  0  1  0  1  1  0  1  1  0  1  1  0  1  1  0  1  2  0  0  1  1  0  1
  0  1  1  1  1 10]
Current best value to beat: 121.270205
Iteration 3 Summary:
  Completed trials: 339 / 379
  Best value found this iteration: 118.081190
  Improvement Found: Yes (121.270205 -&gt; 118.081190)

--- Optimization Iteration 4 ---
Starting with schedule: [3 0 1 1 1 1 0 1 1 0 1 1 0 1 1 0 1 2 0 0 1 1 0 1 0 1 1 1 1 9]
Current best value to beat: 118.081190
Iteration 4 Summary:
  Completed trials: 328 / 419
  Best value found this iteration: 117.791911
  Improvement Found: Yes (118.081190 -&gt; 117.791911)

--- Optimization Iteration 5 ---
Starting with schedule: [3 0 1 1 1 1 0 1 1 0 2 0 0 1 1 0 1 2 0 0 1 1 0 1 1 1 0 2 0 9]
Current best value to beat: 117.791911
Iteration 5 Summary:
  Completed trials: 387 / 459
  Best value found this iteration: 116.120635
  Improvement Found: Yes (117.791911 -&gt; 116.120635)

--- Optimization Iteration 6 ---
Starting with schedule: [3 0 1 1 1 1 0 1 1 1 1 0 1 0 1 1 1 1 0 1 0 1 1 1 1 1 0 1 1 8]
Current best value to beat: 116.120635
Iteration 6 Summary:
  Completed trials: 422 / 499
  Best value found this iteration: 115.928504
  Improvement Found: Yes (116.120635 -&gt; 115.928504)

--- Optimization Iteration 7 ---
Starting with schedule: [3 0 1 1 1 1 0 1 1 1 1 0 1 1 0 1 1 1 0 1 1 1 0 1 1 1 0 1 1 8]
Current best value to beat: 115.928504
Iteration 7 Summary:
  Completed trials: 465 / 539
  Best value found this iteration: 115.293165
  Improvement Found: Yes (115.928504 -&gt; 115.293165)

--- Optimization Iteration 8 ---
Starting with schedule: [2 1 1 1 1 0 1 1 0 1 1 1 1 1 0 1 0 1 1 1 1 0 1 1 1 1 0 1 1 8]
Current best value to beat: 115.293165
Iteration 8 Summary:
  Completed trials: 509 / 579
  Best value found this iteration: 115.171247
  Improvement Found: Yes (115.293165 -&gt; 115.171247)

--- Optimization Iteration 9 ---
Starting with schedule: [2 1 1 1 1 0 1 1 1 0 1 1 1 1 0 1 1 0 1 1 1 0 1 1 1 1 0 1 1 8]
Current best value to beat: 115.171247
Iteration 9 Summary:
  Completed trials: 523 / 619
  Best value found this iteration: 115.171247
  Improvement Found: No

--- Iterative Optimization Finished ---
Stopping Reason: No further improvement found in iteration 9.

--- Final Optimal Result ---
Found after iteration: 8
Final Objective Value: 115.171247
Final Optimal Schedule: [2 1 1 1 1 0 1 1 1 0 1 1 1 1 0 1 1 0 1 1 1 0 1 1 1 1 0 1 1 8]
Sum of Final Schedule: 32

Comparison with Initial Schedule:
  Initial Schedule (Iter 0): [ 2  1  0  1  1  0  1  1  0  1  0  1  1  0  1  1  0  1  1  0  1  0  1  1
  0  1  1  0  1 12]
  Initial Objective Value:   129.616790

Total time taken: 630.71 seconds.
Script finished. Check log file: optuna_vns.log</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>